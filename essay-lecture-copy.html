<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>ESSAY DROP ‚Äî V4</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@700;800;900&family=Instrument+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
/* ‚ïê‚ïê‚ïê PALETTE ‚ïê‚ïê‚ïê */
:root{
  --bg:#f0efec;
  --card:#ffffff;
  --ink:#111111;
  --ink2:rgba(17,17,17,0.62);
  --ink3:rgba(17,17,17,0.28);
  --red:#c9140f;
  --red-s:rgba(201,20,15,0.08);
  --border:rgba(0,0,0,0.07);

  /* paragraph accent colours */
  --c-intro:#3d9e95;
  --c-b1:#c9140f;
  --c-b2:#c9140f;
  --c-b3:#7b5ea7;
  --c-conc:#2d7a3a;
}

*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden;position:fixed;
  background:var(--bg);font-family:'Instrument Sans',sans-serif;
  color:var(--ink);-webkit-font-smoothing:antialiased;}

/* ‚îÄ‚îÄ‚îÄ SHELL ‚îÄ‚îÄ‚îÄ */
.shell{position:fixed;inset:0;display:flex;flex-direction:column;}

/* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
.topbar{
  flex-shrink:0;display:flex;align-items:center;gap:.55rem;
  padding:.48rem .9rem .38rem;
  background:rgba(240,239,236,0.97);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(14px);z-index:100;
}
.logo{font-family:'Barlow Condensed',sans-serif;font-size:1.05rem;font-weight:900;
  letter-spacing:.22em;text-transform:uppercase;color:var(--ink);}
.logo span{color:var(--red);}
.spacer{flex:1;}
.tips-btn{
  font-family:'DM Mono',monospace;font-size:.3rem;letter-spacing:.14em;text-transform:uppercase;
  padding:.2rem .6rem;border-radius:20px;background:rgba(0,0,0,.06);
  color:var(--ink3);border:1px solid var(--border);cursor:pointer;transition:all .2s;
}
.tips-btn:hover{background:rgba(0,0,0,.1);color:var(--ink2);}
.tips-btn.active{background:var(--red-s);color:var(--red);border-color:rgba(201,20,15,.2);}
.tbctr{font-family:'DM Mono',monospace;font-size:.36rem;letter-spacing:.14em;color:var(--ink3);}

/* progress bar */
.pbar-row{flex-shrink:0;display:flex;gap:2.5px;padding:.0rem .9rem .3rem;background:rgba(240,239,236,0.97);}
.pseg{flex:1;height:2px;border-radius:2px;background:rgba(0,0,0,.09);overflow:hidden;position:relative;}
.psegf{position:absolute;inset:0;border-radius:2px;transform:scaleX(0);transform-origin:left;
  transition:transform .45s cubic-bezier(.22,1,.36,1);}
.pseg.done .psegf{transform:scaleX(1);background:var(--red);}
.pseg.active .psegf{transform:scaleX(1);background:var(--ink);}

/* ‚îÄ‚îÄ‚îÄ STAGE ‚îÄ‚îÄ‚îÄ */
.stage{
  flex:1;min-height:0;position:relative;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
  background:var(--bg);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   THE POSTER CARD ‚Äî fixed size, from INTUITY plan
   min(400px,88vw) √ó min(500px,80vh)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.poster{
  position:relative;
  width:min(400px,88vw);
  height:min(500px,80vh);
  background:var(--card);
  border-radius:1.4rem;
  display:flex;flex-direction:column;
  overflow:hidden;
  box-shadow:
    0 2px 0 rgba(255,255,255,0.9) inset,
    4px 6px 0 rgba(0,0,0,0.06),
    0 20px 50px rgba(0,0,0,0.18),
    0 4px 12px rgba(0,0,0,0.1);
  flex-shrink:0;
  animation:pIn .42s cubic-bezier(.22,1,.36,1) both;
}
@keyframes pIn{
  from{opacity:0;transform:translateY(18px) scale(.96);}
  to{opacity:1;transform:none;}
}

/* FLAG ‚Äî big number badge, zigzag bottom, from INTUITY */
.flag{
  position:absolute;top:-2px;left:1.6rem;
  width:72px;z-index:10;
  display:flex;flex-direction:column;align-items:center;
}
.flag-body{
  width:100%;padding:.75rem .3rem .6rem;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  position:relative;gap:.06rem;
}
.flag-num{
  font-family:'Barlow Condensed',sans-serif;
  font-size:clamp(.9rem,2.8vw,1.1rem);font-weight:900;
  letter-spacing:.12em;text-transform:uppercase;
  color:#fff;line-height:1.1;text-align:center;
  padding:0 .2rem;
}
/* zigzag bottom edge */
.flag-body::after{
  content:'';position:absolute;bottom:-8px;left:0;right:0;height:9px;
  background:inherit;
  clip-path:polygon(0% 0%,8.33% 100%,16.66% 0%,25% 100%,33.33% 0%,41.66% 100%,50% 0%,58.33% 100%,66.66% 0%,75% 100%,83.33% 0%,91.66% 100%,100% 0%);
}

/* SECTION LABEL ‚Äî subtle top right, orientation only */
.section-lbl{
  position:absolute;top:1rem;right:1.3rem;
  font-family:'Barlow Condensed',sans-serif;
  font-size:.72rem;font-weight:900;letter-spacing:.18em;
  text-transform:uppercase;opacity:.35;
}

/* CARD BODY ‚Äî scrollable sentences */
.card-body{
  flex:1;min-height:0;
  display:flex;flex-direction:column;
  padding:3.6rem 1.6rem .6rem 1.7rem;
  overflow:hidden;
}

/* micro heading */
.card-heading{
  font-family:'DM Mono',monospace;
  font-size:.28rem;font-weight:500;letter-spacing:.2em;text-transform:uppercase;
  color:rgba(0,0,0,.28);margin-bottom:.5rem;flex-shrink:0;
}

/* Scrollable sentence area */
.sentence-scroll{
  flex:1;min-height:0;
  overflow-y:auto;
  display:flex;flex-direction:column;
  gap:.32rem;
  /* hide scrollbar but allow scroll */
  scrollbar-width:none;
  -ms-overflow-style:none;
}
.sentence-scroll::-webkit-scrollbar{display:none;}

/* Each sentence line */
.s-line{
  font-family:'Instrument Sans',sans-serif;
  font-size:clamp(.92rem,2.5vw,1.06rem);
  font-weight:400;line-height:1.62;
  color:rgba(17,17,17,.78);
  flex-shrink:0;
  opacity:0;transform:translateY(7px);
  transition:opacity .36s ease,transform .42s cubic-bezier(.22,1,.36,1);
  padding:.14rem 0;
  border-bottom:1px solid rgba(0,0,0,.04);
}
.s-line:last-child{border-bottom:none;}
.s-line.in{opacity:1;transform:none;}
.s-line.first{
  color:var(--ink);font-weight:600;
  font-size:clamp(.98rem,2.6vw,1.12rem);
}
/* role badge */
.s-role{
  display:inline-block;
  font-family:'DM Mono',monospace;
  font-size:.26rem;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  padding:.1rem .4rem;border-radius:2px;
  margin-right:.38rem;
  vertical-align:middle;flex-shrink:0;
  border-left:2.5px solid currentColor;
}
/* BUILD MODE ‚Äî claim construction steps */
.build-step{
  font-family:'Barlow Condensed',sans-serif;
  font-size:clamp(1rem,3.2vw,1.2rem);
  font-weight:700;letter-spacing:.01em;
  line-height:1.35;color:var(--ink);
  flex-shrink:0;padding:.2rem 0;
  opacity:0;transform:translateX(-6px);
  transition:opacity .32s ease,transform .36s cubic-bezier(.22,1,.36,1);
}
.build-step.in{opacity:1;transform:none;}
.build-step .part-dim{color:rgba(17,17,17,.28);}
.build-step .part-new{color:var(--red);}
.build-step .part-done{color:var(--ink);}

/* ACCENT BAR ‚Äî bottom */
.accent-bar{height:5px;flex-shrink:0;}

/* WAVE in footer of card */
.card-foot{
  display:flex;align-items:flex-end;justify-content:flex-end;
  padding:.28rem 1.4rem .4rem 0;flex-shrink:0;
}
.wave{display:flex;align-items:flex-end;gap:3px;height:16px;}
.wb{width:3px;border-radius:2px;}
.wb:nth-child(1){height:28%}.wb:nth-child(2){height:62%}.wb:nth-child(3){height:100%}
.wb:nth-child(4){height:72%}.wb:nth-child(5){height:44%}.wb:nth-child(6){height:84%}.wb:nth-child(7){height:52%}
.wave.on .wb{animation:wv .95s ease-in-out infinite;}
.wb:nth-child(1){animation-delay:.00s}.wb:nth-child(2){animation-delay:.08s}
.wb:nth-child(3){animation-delay:.17s}.wb:nth-child(4){animation-delay:.12s}
.wb:nth-child(5){animation-delay:.04s}.wb:nth-child(6){animation-delay:.2s}.wb:nth-child(7){animation-delay:.09s}
@keyframes wv{0%,100%{transform:scaleY(.22);opacity:.18}50%{transform:scaleY(1);opacity:1}}
.wave.off .wb{animation:none;transform:scaleY(.22);opacity:.15;}

/* ‚îÄ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ‚îÄ */
.controls{
  flex-shrink:0;display:flex;align-items:center;gap:.4rem;
  padding:.42rem .85rem calc(env(safe-area-inset-bottom,0px)+.42rem);
  background:rgba(232,231,228,0.97);border-top:1px solid var(--border);
  backdrop-filter:blur(14px);z-index:50;
}
.btn-main{
  flex:1;display:flex;align-items:center;justify-content:center;gap:.35rem;
  padding:.55rem;border:none;border-radius:.55rem;
  font-family:'Barlow Condensed',sans-serif;font-size:.9rem;font-weight:900;
  letter-spacing:.14em;cursor:pointer;transition:all .18s;
  background:var(--red);color:#fff;
  box-shadow:0 3px 0 rgba(100,6,6,.4),0 5px 14px rgba(201,20,15,.13);
}
.btn-main:active{transform:translateY(1px);box-shadow:0 1px 0 rgba(100,6,6,.4);}
.btn-main.running{background:var(--ink);box-shadow:0 3px 0 rgba(0,0,0,.28);}
.btn-nav{
  width:2.5rem;height:2.5rem;border-radius:.55rem;
  background:rgba(0,0,0,.06);border:1px solid var(--border);
  font-family:'Barlow Condensed',sans-serif;font-size:1.2rem;
  color:var(--ink3);cursor:pointer;transition:all .18s;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.btn-nav:hover:not(:disabled){color:var(--ink);background:rgba(0,0,0,.10);}
.btn-nav:active:not(:disabled){transform:scale(.94);}
.btn-nav:disabled{opacity:.15;cursor:not-allowed;}

/* ‚ïê‚ïê‚ïê INTRO PAIRS OVERLAY ‚ïê‚ïê‚ïê */
.ov{
  position:fixed;inset:0;z-index:300;
  background:rgba(240,239,236,0.94);backdrop-filter:blur(20px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:.75rem;pointer-events:none;opacity:0;transition:opacity .26s;
}
.ov.show{opacity:1;pointer-events:all;}

/* The pair poster uses the same poster geometry */
.ob{
  width:min(400px,88vw);height:min(480px,78vh);
  background:var(--card);border-radius:1.4rem;
  box-shadow:4px 6px 0 rgba(0,0,0,.06),0 22px 55px rgba(0,0,0,.18),0 4px 12px rgba(0,0,0,.1);
  overflow:hidden;display:flex;flex-direction:column;
  opacity:0;transform:translateY(24px) scale(.95);
  transition:opacity .36s,transform .44s cubic-bezier(.22,1,.36,1);
  position:relative;flex-shrink:0;
}
.ov.show .ob{opacity:1;transform:none;}
.ob.exit{opacity:0!important;transform:translateX(-44px) scale(.93)!important;transition:opacity .17s,transform .2s ease!important;}

.ob-flag{position:absolute;top:-2px;left:1.6rem;width:72px;z-index:10;}
.ob-flag-body{
  width:100%;padding:.45rem 0 .3rem;background:var(--c-intro);
  display:flex;align-items:center;justify-content:center;position:relative;
}
.ob-flag-body::after{
  content:'';position:absolute;bottom:-8px;left:0;right:0;height:9px;
  background:var(--c-intro);
  clip-path:polygon(0% 0%,8.33% 100%,16.66% 0%,25% 100%,33.33% 0%,41.66% 100%,50% 0%,58.33% 100%,66.66% 0%,75% 100%,83.33% 0%,91.66% 100%,100% 0%);
}
.ob-flag-num{font-family:'Barlow Condensed',sans-serif;font-size:1.75rem;font-weight:900;color:#fff;line-height:1;}
.ob-pair-lbl{position:absolute;top:1rem;right:1.3rem;font-family:'DM Mono',monospace;font-size:.3rem;letter-spacing:.16em;text-transform:uppercase;color:var(--ink3);}

.ob-body{flex:1;min-height:0;padding:3.4rem 1.6rem .5rem 1.7rem;display:flex;flex-direction:column;overflow:hidden;}
.ob-hlbl{font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.2em;text-transform:uppercase;color:rgba(0,0,0,.28);display:flex;align-items:center;gap:.38rem;margin-bottom:.3rem;flex-shrink:0;}
.ob-hlbl::after{content:'';flex:1;height:1px;background:rgba(0,0,0,.06);}
.ob-rl{width:1.5rem;height:3px;border-radius:2px;background:var(--c-intro);margin-bottom:.38rem;flex-shrink:0;}
.ob-starter{
  font-family:'Barlow Condensed',sans-serif;
  font-size:clamp(2rem,8vw,3.5rem);font-weight:900;
  line-height:.9;letter-spacing:.02em;color:var(--ink);flex-shrink:0;
}
.ob-rest{
  font-family:'Instrument Sans',sans-serif;font-weight:400;
  font-size:clamp(.85rem,2.4vw,1rem);line-height:1.55;color:var(--ink2);
  margin-top:.28rem;flex:1;
  opacity:0;transform:translateY(6px);
  transition:opacity .34s .46s,transform .4s .46s cubic-bezier(.22,1,.36,1);
}
.ov.show .ob:not(.exit) .ob-rest{opacity:1;transform:none;}

.ob-sep{height:1px;background:rgba(0,0,0,.06);flex-shrink:0;margin:0 -1.6rem;}
.ob-thesis{flex:1;padding:.6rem 0 0;display:flex;flex-direction:column;justify-content:center;overflow:hidden;}
.ob-tlbl{font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.2em;text-transform:uppercase;color:rgba(0,0,0,.28);display:flex;align-items:center;gap:.38rem;margin-bottom:.28rem;flex-shrink:0;opacity:0;transform:translateX(-5px);transition:opacity .28s .5s,transform .32s .5s;}
.ov.show .ob:not(.exit) .ob-tlbl{opacity:1;transform:none;}
.ob-tlbl::after{content:'';flex:1;height:1px;background:rgba(0,0,0,.06);}
.ob-tt{
  font-family:'Instrument Sans',sans-serif;font-weight:500;
  font-size:clamp(.85rem,2.4vw,1rem);line-height:1.55;color:var(--ink2);
  flex:1;opacity:0;transform:translateY(8px);
  transition:opacity .36s .58s,transform .42s .58s cubic-bezier(.22,1,.36,1);
}
.ob-tt strong{color:var(--c-intro);font-weight:700;}
.ov.show .ob:not(.exit) .ob-tt{opacity:1;transform:none;}
.ob-foot{display:flex;align-items:center;justify-content:space-between;padding:.38rem 1.4rem .5rem 1.7rem;flex-shrink:0;}
.ob-fl{font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.12em;text-transform:uppercase;color:var(--ink3);}
.ob-wave{display:flex;align-items:flex-end;gap:2.5px;height:13px;}
.ob-wb{width:3px;border-radius:2px;background:var(--c-intro);}
.ob-wb:nth-child(1){height:30%}.ob-wb:nth-child(2){height:65%}.ob-wb:nth-child(3){height:100%}.ob-wb:nth-child(4){height:60%}.ob-wb:nth-child(5){height:30%}
.ob-wave.on .ob-wb{animation:wv2 .9s ease-in-out infinite;}
.ob-wb:nth-child(1){animation-delay:.00s}.ob-wb:nth-child(2){animation-delay:.07s}.ob-wb:nth-child(3){animation-delay:.14s}.ob-wb:nth-child(4){animation-delay:.09s}.ob-wb:nth-child(5){animation-delay:.03s}
@keyframes wv2{0%,100%{transform:scaleY(.2);opacity:.18}50%{transform:scaleY(1);opacity:1}}
.ob-bottom{height:4px;background:var(--c-intro);flex-shrink:0;}

.ob-dots{display:flex;gap:6px;margin-top:.5rem;}
.bdot{width:6px;height:6px;border-radius:50%;background:rgba(0,0,0,.14);transition:all .3s cubic-bezier(.22,1,.36,1);}
.bdot.active{transform:scale(1.8);background:var(--ink);}
.bdot.done{background:rgba(0,0,0,.3);}

/* ‚ïê‚ïê‚ïê TIPS PANEL ‚ïê‚ïê‚ïê */
.tips-panel{
  position:fixed;inset:0;z-index:400;
  background:rgba(240,239,236,0.95);backdrop-filter:blur(22px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:.75rem;pointer-events:none;opacity:0;transition:opacity .26s;
}
.tips-panel.show{opacity:1;pointer-events:all;}
.tips-card{
  width:min(420px,96vw);height:min(600px,90vh);
  background:var(--card);border-radius:1.4rem;
  border:1px solid rgba(0,0,0,.06);
  box-shadow:4px 6px 0 rgba(0,0,0,.06),0 24px 60px rgba(0,0,0,.14);
  overflow:hidden;display:flex;flex-direction:column;
  opacity:0;transform:translateX(36px) scale(.96);
  transition:opacity .32s,transform .4s cubic-bezier(.22,1,.36,1);
}
.tips-panel.show .tips-card{opacity:1;transform:none;}
.tips-top{height:4px;background:var(--ink);flex-shrink:0;}
.tips-header{display:flex;align-items:center;justify-content:space-between;padding:.55rem 1rem;border-bottom:1px solid var(--border);flex-shrink:0;}
.tips-title{font-family:'Barlow Condensed',sans-serif;font-size:1.3rem;font-weight:900;letter-spacing:.08em;color:var(--ink);}
.tips-close{font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.12em;text-transform:uppercase;padding:.18rem .5rem;border-radius:20px;background:rgba(0,0,0,.06);color:var(--ink3);border:1px solid var(--border);cursor:pointer;transition:all .18s;}
.tips-close:hover{background:rgba(0,0,0,.12);}
.tips-tabs{display:flex;gap:.25rem;padding:.38rem 1rem .3rem;border-bottom:1px solid var(--border);flex-shrink:0;overflow-x:auto;}
.tips-tabs::-webkit-scrollbar{display:none;}
.tips-tab{font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.1em;text-transform:uppercase;padding:.18rem .55rem;border-radius:20px;background:rgba(0,0,0,.05);color:var(--ink3);border:1px solid var(--border);cursor:pointer;white-space:nowrap;transition:all .18s;}
.tips-tab.on{background:var(--ink);color:#fff;border-color:var(--ink);}
.tips-body{flex:1;overflow-y:auto;padding:.65rem 1rem;-webkit-overflow-scrolling:touch;}
.tips-body::-webkit-scrollbar{width:3px;}
.tips-body::-webkit-scrollbar-thumb{background:rgba(0,0,0,.1);border-radius:2px;}
.t-section{margin-bottom:.75rem;}
.t-stitle{font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.14em;text-transform:uppercase;color:var(--red);margin-bottom:.32rem;}
.t-item{font-family:'Instrument Sans',sans-serif;font-size:clamp(.78rem,2.1vw,.92rem);font-weight:400;line-height:1.55;color:var(--ink2);padding:.24rem 0;border-bottom:1px dashed rgba(0,0,0,.06);}
.t-item:last-child{border-bottom:none;}
.t-item strong{color:var(--ink);font-weight:600;}
.video-wrap{display:flex;flex-direction:column;align-items:center;gap:.55rem;padding:1.2rem .5rem;text-align:center;}
.video-box{width:100%;max-width:300px;aspect-ratio:16/9;background:rgba(0,0,0,.05);border-radius:10px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1.8rem;}
.video-sub{font-family:'Instrument Sans',sans-serif;font-size:clamp(.78rem,2vw,.9rem);color:var(--ink2);line-height:1.5;}

.flash{position:fixed;inset:0;z-index:900;pointer-events:none;opacity:0;transition:opacity .08s;background:var(--red);}
.flash.pop{opacity:.04;transition:opacity 0s;}
.fem{position:fixed;pointer-events:none;z-index:800;font-size:clamp(.9rem,3vw,1.2rem);animation:femUp 2s ease-out forwards;}
@keyframes femUp{0%{opacity:0;transform:translateY(0) scale(.5);}15%{opacity:1;transform:translateY(-10px) scale(1.1);}80%{opacity:.8;transform:translateY(-90px);}100%{opacity:0;transform:translateY(-130px);}}

/* SWIPE HINT */
.swipe-hint{position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);font-family:'DM Mono',monospace;font-size:.26rem;letter-spacing:.2em;text-transform:uppercase;color:var(--ink3);animation:ph 2.5s ease-in-out infinite;pointer-events:none;white-space:nowrap;}
@keyframes ph{0%,100%{opacity:.14}50%{opacity:.32}}

/* SCENE WRAPPER ‚Äî hidden until active */
.scene{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:.6rem;pointer-events:none;opacity:0;}
.scene.active{opacity:1;pointer-events:all;}

@media(max-width:480px){
  .flag-num{font-size:.85rem!important;}
  .section-lbl{font-size:.6rem!important;}
  .s-line,.s-line.first{font-size:clamp(.8rem,4vw,.92rem)!important;}
  .build-step{font-size:clamp(.92rem,4vw,1.1rem)!important;}
}
@media(max-height:580px){
  .s-line{font-size:clamp(.78rem,2vw,.88rem)!important;}
}
</style>
</head>
<body>
<div class="shell">

  <div>
    <div class="topbar">
      <div class="logo">ESSAY<span>_</span>DROP</div>
      <div class="spacer"></div>
      <button class="tips-btn" id="tipsBtn" onclick="toggleTips()">üí° Exam Tips</button>
      <div class="tbctr" id="ctr">1 / 6</div>
    </div>
    <div class="pbar-row" id="pbar"></div>
  </div>

  <div class="stage" id="stage">

    <!-- ‚ïê‚ïê SCENE 0: WHAT IS AN ESSAY ‚ïê‚ïê -->
    <div class="scene active" id="sc0">
      <div class="poster" id="po0">
        <!-- flag -->
        <div class="flag">
          <div class="flag-body" style="background:var(--c-intro)">
            <span class="flag-num">ESSAY</span>
          </div>
        </div>
        <div class="section-lbl" style="color:var(--c-intro)">ESSAY BASICS</div>
        <div class="card-body">
          <div class="card-heading">What is an essay?</div>
          <div class="sentence-scroll" id="stk0">
            <div class="s-line first in">A <span style="color:var(--red);font-weight:700">formal, structured discussion</span> ‚Äî not a story, not a list.</div>
            <div class="s-line in">You give your <span style="color:var(--red);font-weight:700">opinion</span> clearly, then prove it with reasons and examples.</div>
            <div class="s-line in"><span style="color:var(--red);font-weight:700">Five paragraphs:</span> Introduction ‚Üí three body paragraphs ‚Üí Conclusion.</div>
            <div class="s-line in"><span style="color:var(--red);font-weight:700">Formal style</span> throughout: no contractions, no slang.</div>
            <div class="s-line in">Aim for <span style="color:var(--red);font-weight:700">140‚Äì190 words.</span> Every claim needs at least three development sentences.</div>
          </div>
        </div>
        <div class="card-foot">
          <div class="wave off" id="w0">
            <div class="wb" style="background:var(--c-intro)"></div><div class="wb" style="background:var(--c-intro)"></div>
            <div class="wb" style="background:var(--c-intro)"></div><div class="wb" style="background:var(--c-intro)"></div>
            <div class="wb" style="background:var(--c-intro)"></div><div class="wb" style="background:var(--c-intro)"></div>
            <div class="wb" style="background:var(--c-intro)"></div>
          </div>
        </div>
        <div class="accent-bar" style="background:var(--c-intro)"></div>
      </div>
      <div class="swipe-hint">tap start to begin ¬∑ swipe to navigate</div>
    </div>

    <!-- ‚ïê‚ïê SCENE 1: QUESTION ‚ïê‚ïê -->
    <div class="scene" id="sc1">
      <div class="poster" id="po1">
        <div class="flag">
          <div class="flag-body" style="background:var(--c-b1)">
            <span class="flag-num">INTRO</span>
          </div>
        </div>
        <div class="section-lbl" style="color:var(--c-b1)">THE QUESTION</div>
        <div class="card-body">
          <div class="card-heading">üì± Today's essay question</div>
          <div class="sentence-scroll" id="stk1">
            <!-- static content ‚Äî always visible -->
            <div class="s-line first in" style="font-family:'Barlow Condensed',sans-serif;font-size:clamp(1.3rem,4vw,1.7rem);font-weight:900;line-height:1.15;color:var(--ink);border-bottom:none;">
              Should the use of phones be <span style="color:var(--red)">limited</span> for young people?
            </div>
            <div class="s-line in" style="margin-top:.3rem;color:var(--ink2);border-bottom:none;">What do <span style="color:var(--red);font-weight:700">you</span> think? Pick your side ‚Äî then watch how to argue it perfectly.</div>
            <div style="display:flex;gap:.28rem;flex-wrap:wrap;margin-top:.42rem;">
              <span style="font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.1em;padding:.12rem .48rem;border-radius:20px;text-transform:uppercase;background:var(--red-s);color:var(--red);border:1px solid rgba(201,20,15,.14)">B2 essay</span>
              <span style="font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.1em;padding:.12rem .48rem;border-radius:20px;text-transform:uppercase;background:rgba(0,0,0,.05);color:var(--ink3);border:1px solid rgba(0,0,0,.07)">140‚Äì190 words</span>
              <span style="font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.1em;padding:.12rem .48rem;border-radius:20px;text-transform:uppercase;background:rgba(0,0,0,.05);color:var(--ink3);border:1px solid rgba(0,0,0,.07)">5 paragraphs</span>
              <span style="font-family:'DM Mono',monospace;font-size:.28rem;letter-spacing:.1em;padding:.12rem .48rem;border-radius:20px;text-transform:uppercase;background:var(--red-s);color:var(--red);border:1px solid rgba(201,20,15,.14)">own idea required</span>
            </div>
            <div style="display:flex;gap:.28rem;margin-top:.5rem;">
              <div style="flex:1;padding:.38rem .4rem;border-radius:8px;background:rgba(22,163,74,.07);color:#15803d;border:1.5px solid rgba(22,163,74,.18);font-family:'DM Mono',monospace;font-size:.32rem;letter-spacing:.04em;text-align:center;line-height:1.4;">‚úÖ YES<br>limit them</div>
              <div style="flex:1;padding:.38rem .4rem;border-radius:8px;background:rgba(0,0,0,.04);color:var(--ink2);border:1.5px solid rgba(0,0,0,.09);font-family:'DM Mono',monospace;font-size:.32rem;letter-spacing:.04em;text-align:center;line-height:1.4;">ü§î IT<br>depends</div>
              <div style="flex:1;padding:.38rem .4rem;border-radius:8px;background:var(--red-s);color:var(--red);border:1.5px solid rgba(201,20,15,.16);font-family:'DM Mono',monospace;font-size:.32rem;letter-spacing:.04em;text-align:center;line-height:1.4;">‚ùå NO<br>let them</div>
            </div>
          </div>
        </div>
        <div class="card-foot">
          <div class="wave off" id="w1">
            <div class="wb" style="background:var(--c-b1)"></div><div class="wb" style="background:var(--c-b1)"></div>
            <div class="wb" style="background:var(--c-b1)"></div><div class="wb" style="background:var(--c-b1)"></div>
            <div class="wb" style="background:var(--c-b1)"></div><div class="wb" style="background:var(--c-b1)"></div>
            <div class="wb" style="background:var(--c-b1)"></div>
          </div>
        </div>
        <div class="accent-bar" style="background:var(--c-b1)"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SCENE 2: BODY P1 ‚ïê‚ïê -->
    <div class="scene" id="sc2">
      <div class="poster" id="po2">
        <div class="flag">
          <div class="flag-body" style="background:var(--c-b1)">
            <span class="flag-num">BODY 1</span>
          </div>
        </div>
        <div class="section-lbl" style="color:var(--c-b1)">BODY PARAGRAPH 1</div>
        <div class="card-body">
          <div class="card-heading">Paragraph 2 ¬∑ Academic performance</div>
          <div class="sentence-scroll" id="stk2"></div>
        </div>
        <div class="card-foot">
          <div class="wave off" id="w2">
            <div class="wb" style="background:var(--c-b1)"></div><div class="wb" style="background:var(--c-b1)"></div>
            <div class="wb" style="background:var(--c-b1)"></div><div class="wb" style="background:var(--c-b1)"></div>
            <div class="wb" style="background:var(--c-b1)"></div><div class="wb" style="background:var(--c-b1)"></div>
            <div class="wb" style="background:var(--c-b1)"></div>
          </div>
        </div>
        <div class="accent-bar" style="background:var(--c-b1)"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SCENE 3: BODY P2 ‚ïê‚ïê -->
    <div class="scene" id="sc3">
      <div class="poster" id="po3">
        <div class="flag">
          <div class="flag-body" style="background:var(--c-b2)">
            <span class="flag-num">BODY 2</span>
          </div>
        </div>
        <div class="section-lbl" style="color:var(--c-b2)">BODY PARAGRAPH 2</div>
        <div class="card-body">
          <div class="card-heading">Paragraph 3 ¬∑ Mental health &amp; sleep</div>
          <div class="sentence-scroll" id="stk3"></div>
        </div>
        <div class="card-foot">
          <div class="wave off" id="w3">
            <div class="wb" style="background:var(--c-b2)"></div><div class="wb" style="background:var(--c-b2)"></div>
            <div class="wb" style="background:var(--c-b2)"></div><div class="wb" style="background:var(--c-b2)"></div>
            <div class="wb" style="background:var(--c-b2)"></div><div class="wb" style="background:var(--c-b2)"></div>
            <div class="wb" style="background:var(--c-b2)"></div>
          </div>
        </div>
        <div class="accent-bar" style="background:var(--c-b2)"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SCENE 4: BODY P3 OWN IDEA ‚ïê‚ïê -->
    <div class="scene" id="sc4">
      <div class="poster" id="po4">
        <div class="flag">
          <div class="flag-body" style="background:var(--c-b3)">
            <span class="flag-num">BODY 3</span>
          </div>
        </div>
        <div class="section-lbl" style="color:var(--c-b3)">BODY PARAGRAPH 3</div>
        <div class="card-body">
          <div class="card-heading">Paragraph 4 ¬∑ Your own idea</div>
          <div class="sentence-scroll" id="stk4"></div>
        </div>
        <div class="card-foot">
          <div class="wave off" id="w4">
            <div class="wb" style="background:var(--c-b3)"></div><div class="wb" style="background:var(--c-b3)"></div>
            <div class="wb" style="background:var(--c-b3)"></div><div class="wb" style="background:var(--c-b3)"></div>
            <div class="wb" style="background:var(--c-b3)"></div><div class="wb" style="background:var(--c-b3)"></div>
            <div class="wb" style="background:var(--c-b3)"></div>
          </div>
        </div>
        <div class="accent-bar" style="background:var(--c-b3)"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SCENE 5: CONCLUSION ‚ïê‚ïê -->
    <div class="scene" id="sc5">
      <div class="poster" id="po5">
        <div class="flag">
          <div class="flag-body" style="background:var(--c-conc)">
            <span class="flag-num">CONCLU&shy;SION</span>
          </div>
        </div>
        <div class="section-lbl" style="color:var(--c-conc)">CONCLUSION</div>
        <div class="card-body">
          <div class="card-heading">Paragraph 5 ¬∑ Conclusion</div>
          <div class="sentence-scroll" id="stk5"></div>
        </div>
        <div class="card-foot">
          <div class="wave off" id="w5">
            <div class="wb" style="background:var(--c-conc)"></div><div class="wb" style="background:var(--c-conc)"></div>
            <div class="wb" style="background:var(--c-conc)"></div><div class="wb" style="background:var(--c-conc)"></div>
            <div class="wb" style="background:var(--c-conc)"></div><div class="wb" style="background:var(--c-conc)"></div>
            <div class="wb" style="background:var(--c-conc)"></div>
          </div>
        </div>
        <div class="accent-bar" style="background:var(--c-conc)"></div>
      </div>
    </div>

  </div><!-- /stage -->

  <div class="controls">
    <button class="btn-nav" id="btnPrev" onclick="prevScene()" disabled>‚Äπ</button>
    <button class="btn-main" id="btnMain" onclick="handleMain()">‚ñ∂  START</button>
    <button class="btn-nav" id="btnNext" onclick="nextScene()" disabled>‚Ä∫</button>
  </div>
</div>

<!-- ‚ïê‚ïê INTRO PAIRS OVERLAY ‚ïê‚ïê -->
<div class="ov" id="ov">
  <div class="ob" id="ob">
    <div class="ob-flag">
      <div class="ob-flag-body"><span class="ob-flag-num">ü™ù</span></div>
    </div>
    <div class="ob-pair-lbl" id="obNum">1 / 5</div>
    <div class="ob-body">
      <div class="ob-hlbl">Hook ‚Äî how to open</div>
      <div class="ob-rl"></div>
      <div class="ob-starter" id="obS"></div>
      <div class="ob-rest" id="obR"></div>
      <div class="ob-sep"></div>
      <div class="ob-thesis">
        <div class="ob-tlbl">üìå Thesis ‚Äî your argument</div>
        <div class="ob-tt" id="obT"></div>
      </div>
    </div>
    <div class="ob-foot">
      <div class="ob-fl" id="obFL">pair 1 of 5</div>
      <div class="ob-wave" id="obW">
        <div class="ob-wb"></div><div class="ob-wb"></div><div class="ob-wb"></div>
        <div class="ob-wb"></div><div class="ob-wb"></div>
      </div>
    </div>
    <div class="ob-bottom"></div>
  </div>
  <div class="ob-dots" id="obDots"></div>
</div>

<!-- ‚ïê‚ïê TIPS PANEL ‚ïê‚ïê -->
<div class="tips-panel" id="tipsPanel">
  <div class="tips-card">
    <div class="tips-top"></div>
    <div class="tips-header">
      <div class="tips-title">üí° EXAM TIPS</div>
      <div class="tips-close" onclick="closeTips()">‚úï Close</div>
    </div>
    <div class="tips-tabs" id="tipsTabs">
      <div class="tips-tab on" data-tab="descriptors" onclick="switchTipsTab('descriptors')">üìã Descriptors</div>
      <div class="tips-tab" data-tab="linking" onclick="switchTipsTab('linking')">üîó Linking</div>
      <div class="tips-tab" data-tab="planning" onclick="switchTipsTab('planning')">üìù Planning</div>
      <div class="tips-tab" data-tab="wordlimit" onclick="switchTipsTab('wordlimit')">üî¢ Word Limit</div>
      <div class="tips-tab" data-tab="video" onclick="switchTipsTab('video')">‚ñ∂ Video</div>
    </div>
    <div class="tips-body" id="tipsBody"></div>
  </div>
</div>

<div class="flash" id="flash"></div>

<script>
/* ‚ïê‚ïê‚ïê TIPS ‚ïê‚ïê‚ïê */
const TIPS={
  descriptors:[
    {title:'Content (25%)',items:['<strong>Answer the question directly.</strong> Include both given ideas plus your own third idea.','Each point must be developed ‚Äî not just stated.','Missing the third idea = immediate loss of marks.']},
    {title:'Communicative Achievement (25%)',items:['<strong>Formal register throughout.</strong> No contractions, no slang.','Every claim needs a reason or example.','Never "I think" ‚Äî use "In my opinion" or "It seems to me that".']},
    {title:'Organisation (25%)',items:['<strong>Clear paragraphs</strong> with a topic sentence in each.','Logical: claim ‚Üí reason ‚Üí example ‚Üí result.','Different linking word to begin each paragraph.']},
    {title:'Language (25%)',items:['<strong>Range of vocabulary</strong> ‚Äî avoid repetition.','Variety of grammar: passive, relative clauses, conditionals.','Accurate spelling and punctuation.']}
  ],
  linking:[
    {title:'Opinion',items:['"In my opinion," ¬∑ "I firmly believe that" ¬∑ "As far as I am concerned,"']},
    {title:'Adding ideas',items:['"Moreover," ¬∑ "Furthermore," ¬∑ "In addition," ¬∑ "What is more,"']},
    {title:'Contrasting',items:['"However," ¬∑ "On the other hand," ¬∑ "Although" ¬∑ "Nevertheless,"']},
    {title:'Examples',items:['"For instance," ¬∑ "For example," ¬∑ "Indeed,"']},
    {title:'Result',items:['"As a result," ¬∑ "Consequently," ¬∑ "Therefore,"']},
    {title:'Concluding',items:['"In conclusion," ¬∑ "To sum up," ¬∑ "Overall,"']},
    {title:'Sequencing',items:['"Firstly," ¬∑ "Secondly," ¬∑ "Thirdly," ¬∑ "Finally,"']}
  ],
  planning:[
    {title:'The 5-minute exam plan',items:['<strong>Read twice.</strong> Underline the two given ideas.','Decide: agree / disagree / balanced.','Write 3 keywords per paragraph ‚Äî not full sentences.','Decide your OWN third idea BEFORE you start writing.']},
    {title:'The CRER body pattern',items:['<strong>CLAIM</strong> ‚Äî state your point with a listing marker + viewpoint phrase.','<strong>REASON</strong> ‚Äî explain why: "This is because‚Ä¶"','<strong>EXAMPLE</strong> ‚Äî give evidence: "For instance‚Ä¶"','<strong>RESULT</strong> ‚Äî state the consequence: "As a result‚Ä¶"','B2 minimum: at least 3 development sentences after the claim.']},
    {title:'Common mistakes',items:['Never start writing without knowing what P4 will be.','Do not copy the question ‚Äî rephrase everything.','Plan your linking words ‚Äî one different word per paragraph.']}
  ],
  wordlimit:[
    {title:'Target: 140‚Äì190 words',items:['<strong>Under 130 = automatic mark penalty.</strong>','190 words = roughly 12‚Äì15 sentences across 5 paragraphs.','Intro 2‚Äì3 ¬∑ Each body 3‚Äì4 ¬∑ Conclusion 2‚Äì3.']},
    {title:'Quick fixes if too short',items:['Add a result sentence to each body paragraph.','Expand your example ‚Äî name a place, study, or statistic.','Add a concession in P4: "While some argue that‚Ä¶ I believe‚Ä¶"']}
  ],
  video:null
};
let activeTipsTab='descriptors';
function renderTips(tab){
  const body=document.getElementById('tipsBody');
  if(tab==='video'){body.innerHTML=`<div class="video-wrap"><div class="video-box">‚ñ∂</div><div class="video-sub">Paste your YouTube link to embed a lesson video here.</div></div>`;return;}
  const secs=TIPS[tab]||[];let h='';
  secs.forEach(s=>{h+=`<div class="t-section"><div class="t-stitle">${s.title}</div>`;s.items.forEach(it=>{h+=`<div class="t-item">${it}</div>`;});h+='</div>';});
  body.innerHTML=h;
}
function switchTipsTab(t){activeTipsTab=t;document.querySelectorAll('.tips-tab').forEach(b=>b.classList.toggle('on',b.dataset.tab===t));renderTips(t);}
function toggleTips(){const p=document.getElementById('tipsPanel'),b=document.getElementById('tipsBtn'),s=p.classList.contains('show');if(!s){renderTips(activeTipsTab);p.classList.add('show');b.classList.add('active');}else{p.classList.remove('show');b.classList.remove('active');}}
function closeTips(){document.getElementById('tipsPanel').classList.remove('show');document.getElementById('tipsBtn').classList.remove('active');}

/* ‚ïê‚ïê‚ïê ESSAY DATA ‚ïê‚ïê‚ïê */
const WHAT_IS=[
  {t:'A formal, structured discussion ‚Äî not a story, not a list.',        h:'A <k>formal, structured discussion</k> ‚Äî not a story, not a list.'},
  {t:'You give your opinion clearly, then prove it with reasons and examples.', h:'You give your <k>opinion</k> clearly, then prove it with reasons and examples.'},
  {t:'Five paragraphs: Introduction, three body paragraphs, Conclusion.',  h:'<k>Five paragraphs:</k> Introduction ‚Üí three body paragraphs ‚Üí Conclusion.'},
  {t:'Formal style throughout: no contractions, no slang.',                h:'<k>Formal style</k> throughout: no contractions, no slang.'},
  {t:'Aim for 140 to 190 words. Every claim needs at least three development sentences.', h:'Aim for <k>140‚Äì190 words.</k> Every claim needs at least three development sentences.'}
];

const SC1_NARR="Here is today's essay question. Should the use of phones be limited for young people? What do you think? By the end of this lesson you will know exactly how to argue it, sentence by sentence.";

const PAIRS=[
  {s:'Nowadays,',f:'Nowadays, smartphones are used by millions of young people around the world every single day.',r:'smartphones are used by millions of young people around the world every single day.',t:'This essay will discuss the main <strong>advantages and disadvantages</strong> of limiting smartphone use.',tf:'This essay will discuss the main advantages and disadvantages of limiting smartphone use.'},
  {s:'In recent years,',f:'In recent years, there has been a growing debate about whether young people should have unlimited access to their phones.',r:'there has been a growing debate about whether young people should have unlimited access to their phones.',t:'In this essay, I will examine <strong>both sides of the argument</strong> before giving my personal opinion.',tf:'In this essay, I will examine both sides of the argument before giving my personal opinion.'},
  {s:'It is widely believed that',f:'It is widely believed that smartphone use has fundamentally changed the way young people learn, communicate and relax.',r:'smartphone use has fundamentally changed the way young people learn, communicate and relax.',t:'Therefore, it is essential to discuss <strong>the benefits and drawbacks</strong> of restricting these devices.',tf:'Therefore, it is essential to discuss the benefits and drawbacks of restricting these devices.'},
  {s:'Many people argue that',f:'Many people argue that excessive smartphone use is one of the most serious challenges facing young people today.',r:'excessive smartphone use is one of the most serious challenges facing young people today.',t:'The aim of this essay is to consider <strong>whether limiting smartphones</strong> would truly benefit young people.',tf:'The aim of this essay is to consider whether limiting smartphones would truly benefit young people.'},
  {s:'It is impossible to deny that',f:'It is impossible to deny that smartphones play a significant role in the daily lives of young people worldwide.',r:'smartphones play a significant role in the daily lives of young people worldwide.',t:'This essay will argue that <strong>some restrictions</strong> on smartphone use are both necessary and beneficial.',tf:'This essay will argue that some restrictions on smartphone use are both necessary and beneficial.'}
];

/* ‚ïê‚ïê BODY PARAGRAPH DATA
   Each paragraph has:
   - claimBuild: the claim assembled in 3 steps (listing ‚Üí viewpoint ‚Üí full claim)
   - supports: array of {role, text} development sentences (min 3 for B2)
‚ïê‚ïê */
const BODY_PARAS=[
  {
    claimBuild:[
      {speak:'Firstly,', html:'<span class="part-new">Firstly,</span> <span class="part-dim">it seems to me that‚Ä¶ [viewpoint]‚Ä¶ [claim]</span>', label:'LISTING MARKER'},
      {speak:'Firstly, it seems to me that‚Ä¶', html:'<span class="part-done">Firstly,</span> <span class="part-new">it seems to me that</span> <span class="part-dim">‚Ä¶ [the claim]</span>', label:'+ VIEWPOINT'},
      {speak:'Firstly, it seems to me that the key advantage of limiting smartphones is that young people can concentrate more deeply on their studies.',
       html:'<span class="part-done">Firstly, it seems to me that</span> <span class="part-new">the key advantage of limiting smartphones is that young people can concentrate more deeply on their studies.</span>',label:'FULL CLAIM'}
    ],
    supports:[
      {role:'EXPLAIN',  text:'In other words, without constant alerts and notifications, students are far more able to focus for extended periods.',  html:'In other words, without constant alerts, students are far more able to <k>focus for extended periods</k>.'},
      {role:'REASON',   text:'This is because social media and messaging apps are deliberately designed to interrupt attention every few minutes.',   html:'This is because social media apps are <k>deliberately designed to interrupt attention</k> every few minutes.'},
      {role:'EXAMPLE',  text:'For instance, many schools that have introduced phone-free policies have reported a clear improvement in student behaviour and exam results.', html:'For instance, schools with <k>phone-free policies</k> report clear improvement in behaviour and exam results.'},
      {role:'RESULT',   text:'As a result, young people who limit their screen time tend to find it significantly easier to complete homework and achieve higher grades.', html:'As a result, students who limit screen time find it easier to <k>achieve higher grades.</k>'}
    ]
  },
  {
    claimBuild:[
      {speak:'Secondly,', html:'<span class="part-new">Secondly,</span> <span class="part-dim">as far as I am concerned‚Ä¶ [viewpoint]‚Ä¶ [claim]</span>', label:'LISTING MARKER'},
      {speak:'Secondly, as far as I am concerned‚Ä¶', html:'<span class="part-done">Secondly,</span> <span class="part-new">as far as I am concerned,</span> <span class="part-dim">‚Ä¶ [the claim]</span>', label:'+ VIEWPOINT'},
      {speak:"Secondly, as far as I am concerned, restricting smartphones has a direct and positive effect on young people's mental health and quality of sleep.",
       html:"<span class='part-done'>Secondly, as far as I am concerned,</span> <span class='part-new'>restricting smartphones has a direct and positive effect on young people's mental health and quality of sleep.</span>", label:'FULL CLAIM'}
    ],
    supports:[
      {role:'EXPLAIN',  text:'Put differently, when teenagers are not checking their phones at night, both the quality and duration of their sleep improves significantly.', html:'Put differently, less phone use at night means <k>better quality sleep.</k>'},
      {role:'REASON',   text:'This is because the blue light from screens interferes with melatonin production, making it much harder for young people to fall asleep naturally.', html:'This is because <k>blue light</k> from screens interferes with melatonin production.'},
      {role:'EXAMPLE',  text:'For example, research suggests that teenagers who use phones for more than two hours before bed are twice as likely to suffer from sleep deprivation.', html:'For example, research shows teens using phones before bed are <k>twice as likely</k> to suffer sleep deprivation.'},
      {role:'RESULT',   text:'Consequently, setting clear boundaries on evening screen time could have a direct and measurable impact on the wellbeing of millions of young people.', html:'Consequently, <k>clear limits on screen time</k> could measurably improve the wellbeing of millions.'}
    ]
  },
  {
    claimBuild:[
      {speak:'On the other hand,', html:'<span class="part-new">On the other hand,</span> <span class="part-dim">it could be argued that‚Ä¶ [viewpoint]‚Ä¶ [claim]</span>', label:'CONTRAST MARKER'},
      {speak:'On the other hand, it could be argued that‚Ä¶', html:'<span class="part-done">On the other hand,</span> <span class="part-new">it could be argued that</span> <span class="part-dim">‚Ä¶ [the claim]</span>', label:'+ VIEWPOINT'},
      {speak:'On the other hand, it could be argued that smartphones are increasingly valuable tools for independent learning and self-education.',
       html:'<span class="part-done">On the other hand, it could be argued that</span> <span class="part-new">smartphones are increasingly valuable tools for independent learning and self-education.</span>', label:'FULL CLAIM ‚Äî YOUR OWN IDEA'}
    ],
    supports:[
      {role:'EXPLAIN',  text:'In other words, rather than simply being a distraction, a phone in the right hands can become a powerful personal learning device.', html:'In other words, a phone in the right hands can become a <k>powerful learning device.</k>'},
      {role:'REASON',   text:'Many students use their phones to access revision apps, research topics, and collaborate with classmates ‚Äî all of which directly support their education.', html:'Students use phones for <k>revision apps, research and collaboration</k> ‚Äî all supporting education.'},
      {role:'EXAMPLE',  text:'Indeed, platforms such as Duolingo and Khan Academy have transformed smartphones into resources that millions of young learners rely on every day.', html:'Indeed, platforms like <k>Duolingo and Khan Academy</k> have transformed smartphones into learning tools.'},
      {role:'COMPARE',  text:'Unlike a textbook, which is fixed and static, a smartphone gives a student instant access to an entire world of knowledge and learning tools.', html:'Unlike a textbook, a smartphone gives <k>instant access to a world of knowledge.</k>'},
      {role:'BALANCE',  text:'For this reason, teaching young people responsible and mindful use of devices may ultimately be more effective than imposing a complete ban.', html:'For this reason, <k>responsible use</k> may be more effective than a complete ban.'}
    ]
  }
];

const CONCL_DATA=[
  {role:'SUMMARY', text:'In conclusion, I firmly believe that the question of smartphone use for young people requires careful and balanced consideration.', html:'In conclusion, I firmly believe this question requires <k>careful, balanced consideration.</k>'},
  {role:'POINT 1', text:'On one hand, restricting phones leads to improved academic performance, better sleep, and greater overall wellbeing.', html:'On one hand, <k>restricting phones</k> leads to better academic performance, sleep, and wellbeing.'},
  {role:'POINT 2', text:'On the other hand, smartphones offer genuine educational value and should not be dismissed as purely harmful.', html:'On the other hand, smartphones offer <k>genuine educational value</k> and should not be dismissed.'},
  {role:'REWORD',  text:'In other words, it is not the phone itself that is the problem ‚Äî it is how, when, and for how long it is used.', html:'In other words, the problem is not the phone ‚Äî it is <k>how, when, and how long</k> it is used.'},
  {role:'VERDICT', text:'Overall, a measured and balanced approach to limiting smartphone use would benefit the vast majority of young people.', html:'Overall, a <k>measured, balanced approach</k> would benefit the vast majority of young people.'}
];

const TOTAL=6;

/* ‚ïê‚ïê‚ïê ENGINE ‚ïê‚ïê‚ïê */
let cur=0,running=false,bannerOn=false,timers=[];
const synth=window.speechSynthesis;let voice=null;
function loadVoice(){const p=()=>{const v=synth.getVoices();voice=v.find(x=>x.name==='Google UK English Male')||v.find(x=>x.name==='Daniel')||v.find(x=>x.lang==='en-GB')||v.find(x=>x.lang&&x.lang.startsWith('en'))||v[0]||null;};if(synth.getVoices().length)p();else synth.onvoiceschanged=p;}
let sRes=null;
function stopSpeech(){if(sRes){sRes();sRes=null;}synth.cancel();}
function speak(t){return new Promise(r=>{if(!running){r();return;}synth.cancel();sRes=r;const go=()=>{if(!running){r();return;}const u=new SpeechSynthesisUtterance(t);u.voice=voice;u.rate=0.87;u.pitch=1;u.volume=1;u.onend=()=>{sRes=null;r();};u.onerror=()=>{sRes=null;r();};synth.speak(u);};const t2=setTimeout(go,160);timers.push(t2);});}
function wait(ms){return new Promise(r=>{const t=setTimeout(r,ms);timers.push(t);});}

/* ‚îÄ‚îÄ‚îÄ Progress bar ‚îÄ‚îÄ‚îÄ */
function initPbar(){const b=document.getElementById('pbar');b.innerHTML='';for(let i=0;i<TOTAL;i++){const s=document.createElement('div');s.className='pseg';s.id='ps'+i;s.innerHTML='<div class="psegf"></div>';b.appendChild(s);}}
function updatePbar(i){for(let j=0;j<TOTAL;j++){const s=document.getElementById('ps'+j);if(!s)continue;s.classList.toggle('done',j<i);s.classList.toggle('active',j===i);}}

function waveOn(i){const w=document.getElementById('w'+i);if(w){w.classList.remove('off');w.classList.add('on');}}
function waveOff(i){const w=document.getElementById('w'+i);if(w){w.classList.remove('on');w.classList.add('off');}}

function showScene(i){
  document.querySelectorAll('.scene').forEach(s=>s.classList.remove('active'));
  const sc=document.getElementById('sc'+i);if(!sc)return;
  sc.classList.add('active');
  document.getElementById('ctr').textContent=(i+1)+' / '+TOTAL;
  updatePbar(i);updateNavBtns();flashColor();
  if(i>0)spawnEmoji(i);
}

/* Speak text, then append a sentence line */
async function speakThenShow(stkId,text,isFirst,role){
  if(!running)return;
  await speak(text);if(!running)return;
  const stk=document.getElementById(stkId);if(!stk)return;
  const line=document.createElement('div');
  line.className='s-line'+(isFirst?' first':'');
  if(role){
    line.innerHTML=`<span class="s-role" style="color:var(--red);background:rgba(201,20,15,.07)">${role}</span>${text}`;
  } else {
    line.textContent=text;
  }
  stk.appendChild(line);
  await wait(20);line.classList.add('in');
  // scroll the new line into view
  line.scrollIntoView({behavior:'smooth',block:'nearest'});
  await wait(160);
}

/* ‚ïê‚ïê CLAIM BUILD ‚Äî the key pedagogical sequence
   Shows the sentence being assembled piece by piece:
   1. Listing marker alone
   2. + Viewpoint phrase
   3. Full claim lands
   Then clears the build steps and shows final claim as a line
‚ïê‚ïê */
async function buildClaim(stkId,para){
  if(!running)return;
  const stk=document.getElementById(stkId);if(!stk)return;

  // heading
  const heading=document.createElement('div');
  heading.className='s-line first in';
  heading.style.fontFamily="'Barlow Condensed',sans-serif";
  heading.style.fontSize='clamp(.62rem,1.8vw,.72rem)';
  heading.style.fontWeight='900';
  heading.style.letterSpacing='.16em';
  heading.style.textTransform='uppercase';
  heading.style.color='var(--red)';
  heading.style.borderBottom='1px solid rgba(0,0,0,.06)';
  heading.style.paddingBottom='.28rem';
  heading.style.marginBottom='.28rem';
  heading.textContent='BUILDING THE CLAIM ‚Äî step by step';
  stk.appendChild(heading);
  await wait(300);

  let stepEl=null;
  for(let i=0;i<para.claimBuild.length;i++){
    const step=para.claimBuild[i];
    if(!running)return;

    // label
    const lbl=document.createElement('div');
    lbl.style.cssText='font-family:\'DM Mono\',monospace;font-size:.24rem;letter-spacing:.16em;text-transform:uppercase;color:var(--ink3);margin-bottom:.1rem;opacity:0;transition:opacity .3s;';
    stk.appendChild(lbl);
    await wait(20);lbl.style.opacity='1';
    lbl.textContent=step.label;

    // build step
    if(stepEl) stepEl.style.opacity='.28'; // dim previous
    stepEl=document.createElement('div');
    stepEl.className='build-step';
    stepEl.innerHTML=step.html;
    stk.appendChild(stepEl);
    await wait(20);stepEl.classList.add('in');
    stepEl.scrollIntoView({behavior:'smooth',block:'nearest'});

    await speak(step.speak);
    if(!running)return;
    await wait(i<para.claimBuild.length-1?550:300);
  }
  await wait(400);
}

/* ‚ïê‚ïê INTRO PAIRS ‚ïê‚ïê */
async function runPairs(){
  bannerOn=true;
  const ov=document.getElementById('ov');
  document.getElementById('obDots').innerHTML=PAIRS.map((_,i)=>`<div class="bdot" id="bd${i}"></div>`).join('');
  ov.classList.add('show');
  for(let i=0;i<PAIRS.length;i++){if(!running||!bannerOn)break;await showPair(PAIRS[i],i);}
  if(running)closeBanner();
}
async function showPair(p,idx){
  const ob=document.getElementById('ob');
  if(idx>0){ob.classList.add('exit');await wait(190);if(!running||!bannerOn){ob.classList.remove('exit');return;}ob.classList.remove('exit');}
  if(!running||!bannerOn)return;
  document.getElementById('obNum').textContent=(idx+1)+' / '+PAIRS.length;
  document.getElementById('obFL').textContent='pair '+(idx+1)+' of '+PAIRS.length;
  const sEl=document.getElementById('obS');sEl.textContent=p.s;
  const l=p.s.length;sEl.style.fontSize=l>22?'clamp(1.4rem,5.5vw,2.4rem)':l>14?'clamp(1.8rem,7vw,3.1rem)':'clamp(2.1rem,8vw,3.6rem)';
  const rEl=document.getElementById('obR'),tEl=document.getElementById('obT');
  rEl.style.cssText='opacity:0;transform:translateY(6px);transition:none;';tEl.style.cssText='opacity:0;transform:translateY(8px);transition:none;';
  rEl.textContent=p.r;tEl.innerHTML=p.t;
  await wait(24);rEl.style.cssText='';tEl.style.cssText='';
  for(let i=0;i<PAIRS.length;i++){const d=document.getElementById('bd'+i);if(!d)continue;d.classList.toggle('active',i===idx);d.classList.toggle('done',i<idx);}
  document.getElementById('obW').classList.add('on');
  await speak(p.f);if(!running||!bannerOn)return;
  await wait(180);await speak(p.tf);if(!running||!bannerOn)return;
  document.getElementById('obW').classList.remove('on');
  await wait(480);
}
function closeBanner(){document.getElementById('ov').classList.remove('show');document.getElementById('ob').classList.remove('exit');bannerOn=false;}

/* ‚ïê‚ïê‚ïê SCENE RUNNERS ‚ïê‚ïê‚ïê */
async function runScene(idx){
  if(!running)return;
  if(idx>=TOTAL){finishAll();return;}
  clearStacks();showScene(idx);

  if(idx===0){
    // Scene 0 is pre-rendered ‚Äî narrate a brief welcome then move on
    waveOn(0);
    await speak("Welcome to Essay Drop. This lesson will teach you how to write a complete B2 opinion essay, sentence by sentence. Let's begin with the question.");
    waveOff(0);

  }else if(idx===1){
    // Question narration + pairs
    waveOn(1);
    await speak(SC1_NARR);
    waveOff(1);
    if(running){await wait(300);await runPairs();}

  }else if(idx===2||idx===3||idx===4){
    // Body paragraphs ‚Äî teach construction then add supports
    const para=BODY_PARAS[idx-2];
    const stkId='stk'+idx;
    waveOn(idx);

    // Narrate the paragraph structure first
    await speak(`Now let's build paragraph ${idx}. Watch how the claim is constructed ‚Äî listing marker, viewpoint phrase, then the full sentence.`);
    if(!running)return;

    // Build the claim step by step
    await buildClaim(stkId,para);
    if(!running)return;

    await speak('Now listen to how the claim is developed. A strong B2 paragraph needs at least three development sentences after the main claim.');
    if(!running)return;
    await wait(300);

    // Show supports one by one
    for(let i=0;i<para.supports.length;i++){
      if(!running)return;
      const s=para.supports[i];
      const sh=s.html?s.html.replace(/<k>/g,"<span style='color:var(--red);font-weight:700'>").replace(/<\/k>/g,'</span>'):null;
      await speakThenShow(stkId,s.text,false,s.role,sh);
    }
    waveOff(idx);

  }else if(idx===5){
    // Conclusion
    waveOn(5);
    await speak('Finally, the conclusion. Restate your opinion using different words. Never introduce new ideas here.');
    if(!running)return;
    for(let i=0;i<CONCL_DATA.length;i++){
      if(!running)return;
      const row=CONCL_DATA[i];
      const rh=row.html?row.html.replace(/<k>/g,"<span style='color:var(--red);font-weight:700'>").replace(/<\/k>/g,'</span>'):null;
      await speakThenShow('stk5',row.text,i===0,row.role,rh);
    }
    waveOff(5);
  }

  if(!running)return;
  await wait(480);if(!running)return;
  cur=idx+1;runScene(cur);
}

/* ‚ïê‚ïê‚ïê CONTROLS ‚ïê‚ïê‚ïê */
function handleMain(){
  if(!running){running=true;const b=document.getElementById('btnMain');b.textContent='‚èπ  STOP';b.classList.add('running');updateNavBtns();runScene(cur);}
  else stopAll();
}
function stopAll(){running=false;bannerOn=false;stopSpeech();timers.forEach(t=>clearTimeout(t));timers=[];closeBanner();const b=document.getElementById('btnMain');b.textContent=cur===0?'‚ñ∂  START':'‚ñ∂  RESUME';b.classList.remove('running');updateNavBtns();}
function clearStacks(){['stk0','stk2','stk3','stk4','stk5'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML='';});}
function nextScene(){bannerOn=false;stopSpeech();timers.forEach(t=>clearTimeout(t));timers=[];closeBanner();clearStacks();if(cur+1<TOTAL){cur++;running?runScene(cur):showScene(cur);}updateNavBtns();}
function prevScene(){if(cur===0)return;bannerOn=false;stopSpeech();timers.forEach(t=>clearTimeout(t));timers=[];closeBanner();clearStacks();cur=Math.max(0,cur-1);running?runScene(cur):showScene(cur);updateNavBtns();}
function updateNavBtns(){document.getElementById('btnPrev').disabled=cur<=0;document.getElementById('btnNext').disabled=cur>=TOTAL-1;}
function finishAll(){running=false;const b=document.getElementById('btnMain');b.textContent='‚Ü∫  RESTART';b.classList.remove('running');updateNavBtns();b.onclick=()=>{cur=0;clearStacks();b.textContent='‚ñ∂  START';b.onclick=handleMain;initPbar();showScene(0);};}
function flashColor(){const f=document.getElementById('flash');f.classList.add('pop');setTimeout(()=>f.classList.remove('pop'),20);}
const EMJS=[['üìñ'],['üì±'],['ü™ù'],['üí™'],['üí°'],['‚úÖ']];
function spawnEmoji(idx){const list=EMJS[idx]||[];const r=document.getElementById('stage').getBoundingClientRect();list.forEach((em,i)=>{const t=setTimeout(()=>{const el=document.createElement('div');el.className='fem';el.textContent=em;el.style.cssText=`left:${r.left+r.width*.2+Math.random()*r.width*.6}px;top:${r.top+r.height*.45+Math.random()*r.height*.35}px;animation-duration:${1.9+Math.random()*.7}s;`;document.body.appendChild(el);setTimeout(()=>el.remove(),2500);},i*160);timers.push(t);});}

document.addEventListener('keydown',e=>{if(e.key===' '){e.preventDefault();handleMain();}if(e.key==='ArrowRight')nextScene();if(e.key==='ArrowLeft')prevScene();if(e.key==='Escape'){stopAll();closeTips();}});
let _tx=0;
document.addEventListener('touchstart',e=>_tx=e.changedTouches[0].screenX,{passive:true});
document.addEventListener('touchend',e=>{const dx=e.changedTouches[0].screenX-_tx;if(dx<-55)nextScene();if(dx>55)prevScene();});

loadVoice();initPbar();showScene(0);
</script>
</body>
</html>
