<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>ESSAY DROP</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:ital,wght@0,400;0,600;0,700;0,800;0,900;1,700&family=DM+Mono:wght@0,300;0,400;0,500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root {
  --void:#04040c; --w:#f0eeff; --border:rgba(255,255,255,0.07);
  --c-intro:#00e5ff; --c-hook:#ff3d6e; --c-thesis:#ffe234;
  --c-body:#00f5a0;  --c-claim:#b347ff; --c-opinion:#ff6b35;
  --c-support:#2d9cff; --c-conclude:#ffd700;
  --c-reason:#ff3d6e; --c-example:#00e5ff; --c-result:#00f5a0;
  --c-explain:#ffe234; --c-reword:#ff6b35; --c-compare:#b347ff; --c-contrast:#2d9cff;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;position:fixed;background:var(--void);font-family:'Syne',sans-serif;color:var(--w);-webkit-font-smoothing:antialiased;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 80% 60% at 12% 20%,rgba(0,229,255,0.05) 0%,transparent 60%),
             radial-gradient(ellipse 70% 70% at 88% 80%,rgba(255,61,110,0.05) 0%,transparent 60%);}

/* LAYOUT */
.app{position:fixed;inset:0;display:grid;
  grid-template-rows:auto 1fr auto;
  grid-template-columns:1fr 0px;
  grid-template-areas:"topbar topbar""stage poster""ctrl ctrl";
  transition:grid-template-columns 0.7s cubic-bezier(0.22,1,0.36,1);}
.app.poster-open{grid-template-columns:1fr min(420px,42vw);}

/* TOPBAR */
.topbar{grid-area:topbar;display:flex;align-items:center;gap:0.7rem;padding:0.55rem 1rem;
  background:rgba(4,4,12,0.98);border-bottom:1px solid var(--border);backdrop-filter:blur(20px);z-index:50;}
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:0.22em;
  background:linear-gradient(90deg,var(--c-intro),var(--c-hook));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;flex-shrink:0;}
.progress-track{flex:1;height:3px;background:rgba(255,255,255,0.07);border-radius:2px;overflow:hidden;}
.progress-fill{height:100%;border-radius:2px;width:0%;
  background:linear-gradient(90deg,var(--c-intro),var(--c-hook),var(--c-thesis));
  transition:width 0.7s cubic-bezier(0.22,1,0.36,1);}
.stage-counter{font-family:'DM Mono',monospace;font-size:0.56rem;letter-spacing:0.12em;color:rgba(255,255,255,0.22);flex-shrink:0;}

/* STAGE */
.stage{grid-area:stage;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;border-right:1px solid var(--border);}
.scene{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem 2rem;pointer-events:none;opacity:0;}
.scene.active{opacity:1;pointer-events:all;animation:sceneIn 0.35s ease both;}
@keyframes sceneIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}
.scene-col{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.75rem;width:100%;max-width:520px;text-align:center;position:relative;z-index:1;}

/* KINETIC ATOMS */
.k-eyebrow{font-family:'DM Mono',monospace;font-size:clamp(0.5rem,1.6vw,0.62rem);letter-spacing:0.22em;text-transform:uppercase;opacity:0;transform:translateY(10px);transition:opacity 0.3s,transform 0.4s;}
.k-eyebrow.in{opacity:1;transform:translateY(0);}
.k-slam{font-family:'Bebas Neue',sans-serif;font-size:clamp(3rem,9vw,6rem);letter-spacing:0.04em;line-height:0.88;text-align:center;opacity:0;transform:translateY(-50px) scale(1.15);transition:opacity 0.25s,transform 0.38s cubic-bezier(0.22,1,0.36,1);}
.k-slam.in{opacity:1;transform:translateY(0) scale(1);}
.k-body{font-family:'Syne',sans-serif;font-weight:500;font-size:clamp(0.8rem,2.4vw,1rem);line-height:1.7;text-align:center;color:rgba(255,255,255,0.6);max-width:400px;opacity:0;transform:translateY(28px);transition:opacity 0.35s,transform 0.5s cubic-bezier(0.22,1,0.36,1);}
.k-body.in{opacity:1;transform:translateY(0);}
.k-body strong{color:var(--w);}
.k-stamp{font-family:'Bebas Neue',sans-serif;font-size:clamp(0.75rem,2.5vw,1rem);letter-spacing:0.2em;padding:0.22rem 0.85rem;border-radius:3px;border:2px solid currentColor;opacity:0;transform:rotate(-7deg) scale(1.4);transition:opacity 0.2s,transform 0.4s cubic-bezier(0.22,1,0.36,1);}
.k-stamp.in{opacity:1;transform:rotate(-2deg) scale(1);}
.k-divider{width:46px;height:3px;border-radius:2px;margin:0 auto;opacity:0;transform:scaleX(0);transition:opacity 0.3s,transform 0.5s cubic-bezier(0.22,1,0.36,1);}
.k-divider.in{opacity:1;transform:scaleX(1);}
.question-box{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);border-left:4px solid var(--c-thesis);border-radius:0.75rem;padding:1rem 1.2rem;width:100%;max-width:440px;opacity:0;transform:translateY(25px) scale(0.97);transition:opacity 0.4s,transform 0.5s cubic-bezier(0.22,1,0.36,1);}
.question-box.in{opacity:1;transform:translateY(0) scale(1);}
.q-eyebrow{font-family:'DM Mono',monospace;font-size:0.5rem;letter-spacing:0.2em;color:var(--c-thesis);text-transform:uppercase;margin-bottom:0.5rem;}
.q-text{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:clamp(1rem,3.5vw,1.4rem);line-height:1.35;color:var(--w);}
.q-wc{display:inline-block;margin-top:0.55rem;font-family:'DM Mono',monospace;font-size:0.52rem;letter-spacing:0.14em;padding:0.22rem 0.6rem;border-radius:20px;background:rgba(255,226,52,0.15);color:var(--c-thesis);border:1px solid rgba(255,226,52,0.25);}

/* PARA BUILDER */
.para-stage{width:100%;max-width:560px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:1.1rem 1.3rem 1.2rem;text-align:left;min-height:100px;}
.para-stage-label{font-family:'DM Mono',monospace;font-size:0.44rem;letter-spacing:0.2em;text-transform:uppercase;color:rgba(255,255,255,0.2);margin-bottom:0.65rem;display:flex;align-items:center;gap:0.4rem;}
.para-stage-label::after{content:'';flex:1;height:1px;background:rgba(255,255,255,0.07);}
.para-text{font-family:'Barlow Condensed',sans-serif;font-size:clamp(1rem,3vw,1.3rem);font-weight:600;line-height:1.7;min-height:2em;}
.para-ann{width:100%;max-width:560px;display:flex;align-items:center;gap:0.6rem;padding:0.45rem 0.8rem;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);border-top:none;border-radius:0 0 8px 8px;opacity:0;transform:translateY(-4px);transition:opacity 0.3s,transform 0.3s;}
.para-ann.show{opacity:1;transform:translateY(0);}
.ann-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.ann-role{font-family:'Bebas Neue',sans-serif;font-size:0.72rem;letter-spacing:0.16em;flex-shrink:0;}
.ann-note{font-family:'Syne',sans-serif;font-size:0.6rem;color:rgba(255,255,255,0.4);line-height:1.4;}
.wh-listing{color:#000;background:var(--c-claim);font-weight:900;padding:0.05em 0.25em;border-radius:2px;font-family:'Bebas Neue',sans-serif;font-size:1.1em;}
.wh-opinion{color:#000;background:var(--c-opinion);font-weight:900;padding:0.05em 0.25em;border-radius:2px;font-family:'Bebas Neue',sans-serif;}
.wh-claim{color:var(--c-body);font-weight:800;font-style:italic;}
.para-chunk .ci{display:inline;opacity:0;position:relative;top:10px;transition:opacity 0.35s,top 0.4s cubic-bezier(0.22,1,0.36,1);}
.para-chunk .ci.in{opacity:1;top:0;}

/* SUPPORT GRID */
.support-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem;width:100%;max-width:560px;}
.sg-item{display:flex;flex-direction:column;align-items:center;padding:0.55rem 0.4rem;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03);opacity:0;transform:translateY(16px);transition:opacity 0.3s,transform 0.4s cubic-bezier(0.22,1,0.36,1);}
.sg-item.in{opacity:1;transform:translateY(0);}
.sg-dot{width:8px;height:8px;border-radius:50%;margin-bottom:0.3rem;}
.sg-word{font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:0.12em;}
.sg-phrase{font-family:'DM Mono',monospace;font-size:0.42rem;color:rgba(255,255,255,0.35);margin-top:0.15rem;text-align:center;line-height:1.4;}

/* BANNER OVERLAY */
.banner-overlay{position:fixed;inset:0;z-index:200;background:rgba(4,4,12,0.9);backdrop-filter:blur(14px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem 1.2rem;pointer-events:none;opacity:0;transition:opacity 0.25s;}
.banner-overlay.show{opacity:1;pointer-events:all;}
.banner-dots{display:flex;gap:6px;align-items:center;margin-top:1rem;}
.bdot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,0.12);transition:all 0.3s cubic-bezier(0.22,1,0.36,1);}
.bdot.active{transform:scale(1.6);}
.bdot.done{background:rgba(255,255,255,0.38);}

.banner-card{width:min(540px,92vw);background:#fafaf8;border-radius:10px;overflow:hidden;position:relative;box-shadow:0 2px 0 rgba(0,0,0,0.15),6px 6px 0 rgba(0,0,0,0.1),0 40px 90px rgba(0,0,0,0.65);opacity:0;transform:translateX(60px) scale(0.96);transition:opacity 0.38s ease,transform 0.45s cubic-bezier(0.22,1,0.36,1);}
.banner-overlay.show .banner-card{opacity:1;transform:translateX(0) scale(1);}
.banner-card.exit{opacity:0!important;transform:translateX(-60px) scale(0.95)!important;transition:opacity 0.22s ease,transform 0.28s ease!important;}

.bc-topline{height:5px;width:100%;}
.bc-stripe{position:absolute;left:0;top:0;bottom:0;width:8px;border-radius:10px 0 0 10px;}
.bc-badge{position:absolute;top:-0.9rem;left:1.6rem;width:3.2rem;height:3.2rem;border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:'Barlow Condensed',sans-serif;font-size:1.5rem;font-weight:900;color:#fff;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,0 100%);box-shadow:4px 4px 0 rgba(0,0,0,0.25),0 8px 20px rgba(0,0,0,0.3);opacity:0;transform:scale(0.5) rotate(-12deg);transition:opacity 0.3s 0.15s,transform 0.4s 0.15s cubic-bezier(0.34,1.56,0.64,1);}
.banner-overlay.show .banner-card:not(.exit) .bc-badge{opacity:1;transform:scale(1) rotate(-2deg);}
.bc-body{padding:1.5rem 1.6rem 1rem 2rem;display:flex;flex-direction:column;}
.bc-label{font-family:'DM Mono',monospace;font-size:0.5rem;letter-spacing:0.22em;text-transform:uppercase;margin-top:1rem;margin-bottom:0.35rem;opacity:0;transform:translateY(8px);transition:opacity 0.3s 0.25s,transform 0.35s 0.25s cubic-bezier(0.22,1,0.36,1);}
.banner-overlay.show .banner-card:not(.exit) .bc-label{opacity:1;transform:translateY(0);}
.bc-rule{width:2.4rem;height:3px;border-radius:2px;margin-bottom:0.6rem;opacity:0;transform:scaleX(0);transform-origin:left;transition:opacity 0.3s 0.35s,transform 0.4s 0.35s cubic-bezier(0.22,1,0.36,1);}
.banner-overlay.show .banner-card:not(.exit) .bc-rule{opacity:1;transform:scaleX(1);}
.bc-key{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:clamp(1.8rem,5.5vw,2.8rem);line-height:1.0;letter-spacing:0.01em;color:#0d0d18;margin-bottom:0.75rem;}
.bc-key .kw{display:inline-block;opacity:0;transform:translateY(100%);transition:opacity 0.22s,transform 0.3s cubic-bezier(0.22,1,0.36,1);}
.banner-overlay.show .banner-card:not(.exit) .bc-key .kw{opacity:1;transform:translateY(0);}
.bc-divider{border:none;border-top:1px dashed rgba(0,0,0,0.12);margin-bottom:0.7rem;opacity:0;transition:opacity 0.3s 0.5s;}
.banner-overlay.show .banner-card:not(.exit) .bc-divider{opacity:1;}
.bc-sentence{font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:clamp(0.95rem,2.8vw,1.15rem);line-height:1.6;color:rgba(0,0,0,0.52);opacity:0;transform:translateY(10px);transition:opacity 0.4s 0.55s,transform 0.45s 0.55s cubic-bezier(0.22,1,0.36,1);}
.bc-sentence strong{color:rgba(0,0,0,0.78);font-weight:800;}
.banner-overlay.show .banner-card:not(.exit) .bc-sentence{opacity:1;transform:translateY(0);}
.bc-footer{display:flex;align-items:center;justify-content:space-between;padding:0.6rem 1.6rem 1rem 2rem;border-top:1px solid rgba(0,0,0,0.06);margin-top:0.4rem;opacity:0;transition:opacity 0.3s 0.65s;}
.banner-overlay.show .banner-card:not(.exit) .bc-footer{opacity:1;}
.bc-footer-label{font-family:'DM Mono',monospace;font-size:0.44rem;letter-spacing:0.18em;text-transform:uppercase;color:rgba(0,0,0,0.28);}
.bc-wave{display:flex;align-items:flex-end;gap:2.5px;height:20px;}
.bc-wave-bar{width:3px;border-radius:3px;opacity:0.22;}
.bc-wave-bar.speaking{animation:waveAnim 0.9s ease-in-out infinite;opacity:1;}
.bc-wave-bar:nth-child(1){height:5px;animation-delay:0s}.bc-wave-bar:nth-child(2){height:12px;animation-delay:0.07s}
.bc-wave-bar:nth-child(3){height:20px;animation-delay:0.14s}.bc-wave-bar:nth-child(4){height:11px;animation-delay:0.09s}
.bc-wave-bar:nth-child(5){height:6px;animation-delay:0.03s}
@keyframes waveAnim{0%,100%{transform:scaleY(0.2);opacity:0.18}50%{transform:scaleY(1);opacity:1}}

/* POSTER PANEL */
.poster-panel{grid-area:poster;background:#eeecea;overflow:hidden;display:flex;flex-direction:column;border-left:1px solid rgba(0,0,0,0.1);}
.poster-head{flex-shrink:0;background:#0c0c1e;padding:0.7rem 0.9rem;border-bottom:3px solid var(--c-intro);}
.poster-head-title{font-family:'Bebas Neue',sans-serif;font-size:0.95rem;letter-spacing:0.26em;background:linear-gradient(90deg,var(--c-intro),var(--c-hook));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.poster-head-sub{font-family:'Syne',sans-serif;font-size:0.48rem;font-weight:600;color:rgba(255,255,255,0.3);margin-top:0.15rem;}
.poster-inner{flex:1;overflow-y:auto;overflow-x:hidden;padding:0.5rem 0.55rem 3rem;scrollbar-width:thin;scrollbar-color:rgba(0,0,0,0.12) transparent;display:flex;flex-direction:column;gap:0.3rem;}
.poster-section-head{font-family:'Bebas Neue',sans-serif;font-size:0.65rem;letter-spacing:0.2em;padding:0.35rem 0.6rem;border-radius:4px;flex-shrink:0;margin-top:0.4rem;}
.poster-card{width:100%;flex-shrink:0;background:#fafaf8;border-radius:7px;overflow:hidden;box-shadow:2px 3px 10px rgba(0,0,0,0.1);border:1px solid rgba(0,0,0,0.05);}
.pc-topline{height:4px;}
.pc-body{padding:0.55rem 0.7rem 0.55rem 1rem;position:relative;}
.pc-stripe{position:absolute;left:0;top:0;bottom:0;width:5px;}
.pc-badge{display:inline-flex;align-items:center;justify-content:center;width:1.6rem;height:1.6rem;border-radius:3px;font-family:'Barlow Condensed',sans-serif;font-size:0.8rem;font-weight:900;color:#fff;margin-bottom:0.25rem;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,0 100%);}
.pc-label{font-family:'DM Mono',monospace;font-size:0.42rem;letter-spacing:0.18em;text-transform:uppercase;margin-bottom:0.2rem;}
.pc-rule{height:2px;border-radius:1px;width:1.8rem;margin-bottom:0.3rem;}
.pc-key{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:1.05rem;line-height:1;color:#0d0d18;margin-bottom:0.3rem;}
.pc-sent{font-family:'Barlow Condensed',sans-serif;font-size:0.7rem;font-weight:600;line-height:1.5;color:rgba(0,0,0,0.5);}
.pc-sent strong{color:rgba(0,0,0,0.75);font-weight:800;}

/* CONTROLS */
.controls{grid-area:ctrl;display:flex;align-items:center;gap:0.45rem;padding:0.55rem 0.9rem calc(env(safe-area-inset-bottom,0px)+0.55rem);background:rgba(4,4,12,0.99);border-top:1px solid var(--border);backdrop-filter:blur(16px);z-index:50;}
.btn-main{flex:1;display:flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.65rem;border:none;border-radius:0.7rem;font-family:'Barlow Condensed',sans-serif;font-size:0.82rem;font-weight:900;letter-spacing:0.1em;text-transform:uppercase;cursor:pointer;transition:all 0.2s;background:linear-gradient(135deg,var(--c-intro),var(--c-support));color:#04040c;box-shadow:0 4px 18px rgba(0,229,255,0.18);}
.btn-main:hover{transform:translateY(-2px);}
.btn-main.stop{background:linear-gradient(135deg,var(--c-hook),rgba(255,61,110,0.65));}
.btn-skip{padding:0.65rem 0.85rem;border-radius:0.7rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.09);font-family:'Barlow Condensed',sans-serif;font-size:0.75rem;font-weight:800;letter-spacing:0.08em;text-transform:uppercase;color:rgba(255,255,255,0.35);cursor:pointer;transition:all 0.2s;}
.btn-skip:hover{color:var(--w);background:rgba(255,255,255,0.09);}
.btn-skip:disabled{opacity:0.22;cursor:not-allowed;}
.flash{position:fixed;inset:0;z-index:900;pointer-events:none;opacity:0;transition:opacity 0.08s;}
.flash.pop{opacity:0.12;transition:opacity 0s;}
.pt{position:fixed;pointer-events:none;z-index:800;border-radius:2px;animation:ptFly 0.9s ease-out forwards;}
@keyframes ptFly{0%{opacity:1;transform:translateY(0) rotate(0)}100%{opacity:0;transform:translateY(-140px) rotate(720deg)}}
@media(max-width:620px){.app.poster-open{grid-template-columns:1fr}.poster-panel{display:none}}
</style>
</head>
<body>
<div class="app" id="app">

<div class="topbar">
  <div class="logo">ESSAY DROP</div>
  <div class="progress-track"><div class="progress-fill" id="pfill"></div></div>
  <div class="stage-counter" id="sctr">01 / 10</div>
</div>

<div class="stage" id="stage">

  <!-- 0: Question -->
  <div class="scene active" id="sc0">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-thesis)">üì± B2 Writing Task</div>
      <div class="k-slam" style="color:var(--c-thesis);font-size:clamp(2rem,7vw,4rem);">READ THIS.</div>
      <div class="question-box">
        <div class="q-eyebrow">Essay Question</div>
        <div class="q-text">"The use of smartphones should be limited for young people."<br><strong style="color:var(--c-thesis)">Do you agree?</strong></div>
        <div class="q-wc">140‚Äì190 words</div>
      </div>
      <div class="k-body">By the end of this lesson you will know <strong>exactly</strong> how to answer this.</div>
    </div>
  </div>

  <!-- 1: What is an essay -->
  <div class="scene" id="sc1">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-intro)">B2 English Writing</div>
      <div class="k-slam" style="color:var(--c-intro)">WHAT IS<br>AN ESSAY?</div>
      <div class="k-divider" style="background:var(--c-intro)"></div>
      <div class="k-body">A <strong>formal, structured discussion.</strong><br>Not a story. Not a list. You give your opinion and back it up with evidence.</div>
      <div class="k-stamp" style="color:var(--c-hook);border-color:var(--c-hook);">DISCUSS ¬∑ ARGUE ¬∑ CONCLUDE</div>
    </div>
  </div>

  <!-- 2: 3 Parts -->
  <div class="scene" id="sc2">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-thesis)">Essay Architecture</div>
      <div class="k-slam" style="color:var(--c-thesis)">3 PARTS.</div>
      <div class="k-divider" style="background:var(--c-thesis)"></div>
      <div class="k-body">Every B2 essay has the same skeleton.<br><strong>Introduction ¬∑ Body ¬∑ Conclusion.</strong><br>Each part has one job.</div>
    </div>
  </div>

  <!-- 3: Introduction + hook banners -->
  <div class="scene" id="sc3">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-intro)">Part One</div>
      <div class="k-slam" style="color:var(--c-intro)">INTRODUCTION</div>
      <div class="k-divider" style="background:var(--c-intro)"></div>
      <div class="k-body"><strong>Two sentences. Two jobs.</strong><br>Hook the reader. Then state what the essay will argue.</div>
      <div class="k-stamp" style="color:var(--c-hook);border-color:var(--c-hook);">5 HOOK PHRASES ‚Üí</div>
    </div>
  </div>

  <!-- 4: Thesis + thesis banners -->
  <div class="scene" id="sc4">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-thesis)">Introduction ‚Äî Sentence 2</div>
      <div class="k-slam" style="color:var(--c-thesis)">THESIS</div>
      <div class="k-divider" style="background:var(--c-thesis)"></div>
      <div class="k-body">One sentence that tells the examiner <strong>what your essay will argue.</strong></div>
      <div class="k-stamp" style="color:var(--c-thesis);border-color:var(--c-thesis);">3 THESIS PHRASES ‚Üí</div>
    </div>
  </div>

  <!-- 5: Body paragraph -->
  <div class="scene" id="sc5">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-body)">Part Two</div>
      <div class="k-slam" style="color:var(--c-body)">BODY<br>PARAGRAPH</div>
      <div class="k-divider" style="background:var(--c-body)"></div>
      <div class="k-body">The engine room. Every body paragraph follows the same pattern.<br><strong>Claim ‚Üí Support ‚Üí Support ‚Üí Support.</strong></div>
    </div>
  </div>

  <!-- 6: The Claim builds -->
  <div class="scene" id="sc6">
    <div class="scene-col" style="gap:0.5rem;">
      <div class="k-eyebrow" style="color:var(--c-claim)">Body ‚Äî Sentence 1</div>
      <div class="k-slam" style="color:var(--c-claim);font-size:clamp(1.8rem,6vw,3.5rem);">THE CLAIM</div>
      <div class="para-stage" id="ps6">
        <div class="para-stage-label">BUILDING YOUR CLAIM‚Ä¶</div>
        <div class="para-text" id="pt6"></div>
      </div>
      <div class="para-ann" id="pa6">
        <div class="ann-dot" style="background:var(--c-claim)"></div>
        <div class="ann-role" style="color:var(--c-claim)">THREE MOVES</div>
        <div class="ann-note">Listing word ‚Üí Opinion phrase ‚Üí The point itself</div>
      </div>
    </div>
  </div>

  <!-- 7: Support ‚Äî 7 words -->
  <div class="scene" id="sc7">
    <div class="scene-col" style="gap:0.65rem;">
      <div class="k-eyebrow" style="color:var(--c-support)">Body ‚Äî Sentences 2‚Äì4</div>
      <div class="k-slam" style="color:var(--c-support);font-size:clamp(1.8rem,6vw,3.2rem);">SUPPORT<br>THE CLAIM</div>
      <div class="k-body" style="max-width:480px;">Choose from <strong>7 linking strategies</strong> to develop your argument.</div>
      <div class="support-grid" id="supportGrid"></div>
    </div>
  </div>

  <!-- 8: 3 body paragraphs -->
  <div class="scene" id="sc8">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-body)">Body Structure</div>
      <div class="k-slam" style="color:var(--c-body)">3 BODY<br>PARAGRAPHS</div>
      <div class="k-divider" style="background:var(--c-body)"></div>
      <div class="k-body">Each one follows the same strict pattern.<br><strong>Claim ‚Üí Support ‚Üí Support ‚Üí Support.</strong><br>Three paragraphs. Three arguments. One clear position.</div>
    </div>
  </div>

  <!-- 9: Conclusion + closing banners -->
  <div class="scene" id="sc9">
    <div class="scene-col">
      <div class="k-eyebrow" style="color:var(--c-conclude)">Part Three</div>
      <div class="k-slam" style="color:var(--c-conclude)">CONCLUSION</div>
      <div class="k-divider" style="background:var(--c-conclude)"></div>
      <div class="k-body"><strong>No new ideas.</strong> Summarise your argument. Give your final verdict on smartphones.</div>
      <div class="k-stamp" style="color:var(--c-conclude);border-color:var(--c-conclude);">4 CLOSING PHRASES ‚Üí</div>
    </div>
  </div>

</div><!-- /stage -->

<!-- POSTER ‚Äî hidden, reveals at end -->
<div class="poster-panel" id="posterPanel">
  <div class="poster-head">
    <div class="poster-head-title">B2 ESSAY ‚Äî PHRASE BANK</div>
    <div class="poster-head-sub">üì± Smartphones &amp; Young People ¬∑ Scroll to review all phrases</div>
  </div>
  <div class="poster-inner" id="posterInner"></div>
</div>

<div class="flash" id="flash"></div>
<div class="controls">
  <button class="btn-main" id="btnMain" onclick="handleMain()">‚ñ∂  START</button>
  <button class="btn-skip" id="btnSkip" onclick="skipNow()" disabled>SKIP ‚Ä∫</button>
</div>
</div>

<!-- BANNER OVERLAY -->
<div class="banner-overlay" id="bannerOverlay">
  <div class="banner-card" id="bannerCard">
    <div class="bc-topline" id="bcTopline"></div>
    <div class="bc-stripe"  id="bcStripe"></div>
    <div class="bc-badge"   id="bcBadge">1</div>
    <div class="bc-body">
      <div class="bc-label"    id="bcLabel"></div>
      <div class="bc-rule"     id="bcRule"></div>
      <div class="bc-key"      id="bcKey"></div>
      <hr  class="bc-divider"/>
      <div class="bc-sentence" id="bcSentence"></div>
    </div>
    <div class="bc-footer">
      <div class="bc-footer-label" id="bcFooterLabel"></div>
      <div class="bc-wave" id="bcWave">
        <div class="bc-wave-bar"></div><div class="bc-wave-bar"></div>
        <div class="bc-wave-bar"></div><div class="bc-wave-bar"></div>
        <div class="bc-wave-bar"></div>
      </div>
    </div>
  </div>
  <div class="banner-dots" id="bannerDots"></div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SUPPORT_WORDS = [
  {word:'REASON',  phrase:'This is because‚Ä¶',  color:'var(--c-reason)'},
  {word:'EXPLAIN', phrase:'In other words‚Ä¶',    color:'var(--c-explain)'},
  {word:'EXAMPLE', phrase:'For instance‚Ä¶',      color:'var(--c-example)'},
  {word:'REWORD',  phrase:'That is to say‚Ä¶',    color:'var(--c-reword)'},
  {word:'RESULT',  phrase:'As a result‚Ä¶',       color:'var(--c-result)'},
  {word:'COMPARE', phrase:'Similarly‚Ä¶',         color:'var(--c-compare)'},
  {word:'CONTRAST',phrase:'However‚Ä¶',           color:'var(--c-contrast)'},
];

const PHRASE_SETS = {
  hook:{
    color:'#ff3d6e', label:'HOOK PHRASE', sectionLabel:'INTRODUCTION ‚Äî Hook',
    phrases:[
      {num:1,key:'Nowadays,',                    sentence:'Nowadays, smartphones are used by millions of young people around the world every single day.'},
      {num:2,key:'In recent years,',             sentence:'In recent years, there has been a growing debate about whether young people should have unlimited access to their phones.'},
      {num:3,key:'It is widely believed that',   sentence:'It is widely believed that smartphone use has changed the way young people learn, communicate and relax.'},
      {num:4,key:'Many people argue that',       sentence:'Many people argue that excessive smartphone use is one of the most serious challenges facing young people today.'},
      {num:5,key:'It is impossible to deny that',sentence:'It is impossible to deny that smartphones play a significant role in the daily lives of young people.'},
    ]
  },
  thesis:{
    color:'#ffe234', label:'THESIS PHRASE', sectionLabel:'INTRODUCTION ‚Äî Thesis',
    phrases:[
      {num:1,key:'This essay will discuss',      sentence:'This essay will discuss the main advantages and disadvantages of limiting smartphone use for young people.'},
      {num:2,key:'In this essay, I will examine',sentence:'In this essay, I will examine both sides of the argument before giving my personal opinion.'},
      {num:3,key:'The aim of this essay is to',  sentence:'The aim of this essay is to consider whether limiting smartphones would truly benefit young people.'},
    ]
  },
  conclusion:{
    color:'#ffd700', label:'CLOSING PHRASE', sectionLabel:'CONCLUSION',
    phrases:[
      {num:1,key:'To sum up,',             sentence:'To sum up, limiting smartphones has both real advantages and some drawbacks for young people.'},
      {num:2,key:'Overall, I believe that',sentence:'Overall, I believe that the benefits of limiting screen time outweigh the drawbacks for young people.'},
      {num:3,key:'All things considered,', sentence:'All things considered, restricting smartphone use can be positive if it is done in a balanced and fair way.'},
      {num:4,key:'In conclusion,',         sentence:'In conclusion, I firmly believe that setting clear limits on smartphone use would help young people perform better at school and lead healthier lives.'},
    ]
  }
};

const CLAIM_CHUNKS = [
  {html:`<span class="wh-listing">Firstly,</span>`,                 delay:0},
  {html:` <span class="wh-opinion">it seems to me that</span>`,     delay:700},
  {html:` <span class="wh-claim">the key advantage of limiting smartphone use for young people is that it allows them to focus more deeply on their studies.</span>`, delay:1500},
];

const NARRATION = [
  "Here is your essay question for today. The use of smartphones should be limited for young people. Do you agree? By the end of this lesson, you will know exactly how to answer this.",
  "So ‚Äî what is an essay? An essay is a formal, structured discussion. Not a story. Not a personal letter. You give your opinion on the question, and you support that opinion with reasons and evidence.",
  "Every B2 essay has the same skeleton. Three parts. The introduction, the body, and the conclusion. Each part has one specific job. Learn the jobs and the essay almost writes itself.",
  "The introduction has two sentences ‚Äî two only. The first is the hook. A powerful opening that immediately engages the reader. Here are five hook phrases you can use right now.",
  "The second sentence of your introduction is the thesis. This tells the examiner exactly what your essay will argue. One clear, confident statement. Here are three thesis structures.",
  "Now we reach the engine room ‚Äî the body paragraph. Every body paragraph follows the same four-move structure. First the claim, then three supporting sentences.",
  "The claim is your first sentence and it has three parts working together. A listing word ‚Äî Firstly. An opinion phrase ‚Äî it seems to me that. And then the point itself. Watch them arrive one by one.",
  "Once you have made your claim, you need to support it. You have seven linking strategies to choose from. Reason, explain, example, reword, result, compare, or contrast. Use any combination across your supporting sentences.",
  "Your essay needs three body paragraphs. Each one follows this exact same pattern ‚Äî claim, then support. Three separate arguments. Three clear points. One strong position.",
  "And finally ‚Äî the conclusion. No new ideas. Simply gather everything you have argued and deliver your final verdict. End with a clear, confident statement.",
];

const SCENE_COLORS = [
  'var(--c-thesis)','var(--c-intro)','var(--c-thesis)',
  'var(--c-intro)','var(--c-thesis)','var(--c-body)',
  'var(--c-claim)','var(--c-support)','var(--c-body)','var(--c-conclude)'
];
const TOTAL = 10;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let current=0, isRunning=false, bannerActive=false, animTimers=[];
const synth=window.speechSynthesis;
let voice=null;
const posterSections={};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VOICE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function loadVoice(){
  const pick=()=>{
    const v=synth.getVoices();
    voice=v.find(x=>x.name==='Google UK English Male')
          ||v.find(x=>x.name==='Daniel')
          ||v.find(x=>x.lang==='en-GB')
          ||v.find(x=>x.lang&&x.lang.startsWith('en'))
          ||v[0]||null;
  };
  if(synth.getVoices().length) pick(); else synth.onvoiceschanged=pick;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ASYNC ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function wait(ms){return new Promise(r=>{const t=setTimeout(r,ms);animTimers.push(t);});}

function speakText(text){
  return new Promise(resolve=>{
    if(!isRunning){resolve();return;}
    synth.cancel();
    const t=setTimeout(()=>{
      if(!isRunning){resolve();return;}
      const u=new SpeechSynthesisUtterance(text);
      u.voice=voice;u.rate=0.88;u.pitch=1.05;u.volume=1;
      u.onend=resolve;u.onerror=resolve;
      synth.speak(u);
    },120);
    animTimers.push(t);
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCENE ANIM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ANIM_MAP=[
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.question-box',d:420},{sel:'.k-body',d:820}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640},{sel:'.k-stamp',d:1000}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640},{sel:'.k-stamp',d:950}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640},{sel:'.k-stamp',d:920}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-body',d:480}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640}],
  [{sel:'.k-eyebrow',d:0},{sel:'.k-slam',d:160},{sel:'.k-divider',d:440},{sel:'.k-body',d:640},{sel:'.k-stamp',d:980}],
];
function animIn(idx){
  const sc=document.getElementById('sc'+idx);if(!sc)return;
  sc.querySelectorAll('.k-eyebrow,.k-slam,.k-body,.k-stamp,.k-divider,.question-box').forEach(el=>el.classList.remove('in'));
  (ANIM_MAP[idx]||[]).forEach(({sel,d})=>{
    sc.querySelectorAll(sel).forEach((el,i)=>{
      const t=setTimeout(()=>el.classList.add('in'),d+i*80);animTimers.push(t);
    });
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLAIM BUILDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildClaim(){
  const pt=document.getElementById('pt6'),pa=document.getElementById('pa6');
  if(!pt)return; pt.innerHTML=''; if(pa)pa.classList.remove('show');
  CLAIM_CHUNKS.forEach(chunk=>{
    const w=document.createElement('span');w.className='para-chunk';
    const i=document.createElement('span');i.className='ci';
    i.innerHTML=chunk.html;w.appendChild(i);pt.appendChild(w);
    const t=setTimeout(()=>i.classList.add('in'),800+chunk.delay);animTimers.push(t);
  });
  const last=CLAIM_CHUNKS[CLAIM_CHUNKS.length-1].delay;
  const t=setTimeout(()=>{if(pa)pa.classList.add('show');},800+last+600);animTimers.push(t);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUPPORT GRID ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildSupport(){
  const g=document.getElementById('supportGrid');if(!g)return;g.innerHTML='';
  SUPPORT_WORDS.forEach((w,i)=>{
    const el=document.createElement('div');el.className='sg-item';
    el.innerHTML=`<div class="sg-dot" style="background:${w.color}"></div><div class="sg-word" style="color:${w.color}">${w.word}</div><div class="sg-phrase">${w.phrase}</div>`;
    g.appendChild(el);
    const t=setTimeout(()=>el.classList.add('in'),600+i*110);animTimers.push(t);
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BANNERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function runBanners(key){
  const set=PHRASE_SETS[key];if(!set)return;
  bannerActive=true;
  const dotsEl=document.getElementById('bannerDots');
  dotsEl.innerHTML=set.phrases.map((_,i)=>`<div class="bdot" id="bdot${i}"></div>`).join('');
  document.getElementById('bannerOverlay').classList.add('show');
  for(let i=0;i<set.phrases.length;i++){
    if(!isRunning||!bannerActive)break;
    await showBanner(set.phrases[i],i,set);
    if(!isRunning||!bannerActive)break;
  }
  if(isRunning)closeBanners();
}

async function showBanner(phrase,idx,set){
  const card=document.getElementById('bannerCard');
  if(idx>0){
    card.classList.add('exit');
    await wait(240);
    if(!isRunning||!bannerActive){card.classList.remove('exit');return;}
    card.classList.remove('exit');
  }
  if(!isRunning||!bannerActive)return;

  const col=set.color;
  document.getElementById('bcTopline').style.background=col;
  document.getElementById('bcStripe').style.background=col;
  document.getElementById('bcBadge').style.background=col;
  document.getElementById('bcBadge').textContent=phrase.num;
  document.getElementById('bcLabel').style.color=col;
  document.getElementById('bcLabel').textContent=set.label;
  document.getElementById('bcRule').style.background=col;
  document.getElementById('bcFooterLabel').textContent=set.label+' ¬∑ '+phrase.num+' / '+set.phrases.length;
  document.querySelectorAll('.bc-wave-bar').forEach(b=>b.style.background=col);

  const keyEl=document.getElementById('bcKey');
  keyEl.innerHTML=phrase.key.split(' ').map((w,wi)=>
    `<span class="kw" style="transition-delay:${0.3+wi*0.06}s">${w}&nbsp;</span>`
  ).join('');

  const esc=phrase.key.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
  document.getElementById('bcSentence').innerHTML=
    phrase.sentence.replace(new RegExp(`(${esc})`,'i'),'<strong>$1</strong>');

  updateDots(idx,set.phrases.length,col);
  document.querySelectorAll('.bc-wave-bar').forEach(b=>b.classList.add('speaking'));

  await speakText(phrase.sentence);
  if(!isRunning||!bannerActive)return;

  document.querySelectorAll('.bc-wave-bar').forEach(b=>b.classList.remove('speaking'));
  addToPoster(phrase,set);

  await wait(500);
  if(!isRunning||!bannerActive)return;
}

function closeBanners(){
  document.getElementById('bannerOverlay').classList.remove('show');
  document.getElementById('bannerCard').classList.remove('exit');
  bannerActive=false;
}

function updateDots(ai,total,col){
  for(let i=0;i<total;i++){
    const d=document.getElementById('bdot'+i);if(!d)continue;
    d.classList.toggle('active',i===ai);d.classList.toggle('done',i<ai);
    d.style.background=i===ai?col:i<ai?'rgba(255,255,255,0.38)':'rgba(255,255,255,0.12)';
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê POSTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function addToPoster(phrase,set){
  const inner=document.getElementById('posterInner');
  if(!posterSections[set.sectionLabel]){
    const h=document.createElement('div');h.className='poster-section-head';
    h.textContent=set.sectionLabel;h.style.color=set.color;
    h.style.background=set.color+'18';h.style.borderLeft='3px solid '+set.color;
    inner.appendChild(h);posterSections[set.sectionLabel]=h;
  }
  const col=set.color;
  const esc=phrase.key.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
  const sent=phrase.sentence.replace(new RegExp(`(${esc})`,'i'),'<strong>$1</strong>');
  const card=document.createElement('div');card.className='poster-card';
  card.innerHTML=`<div class="pc-topline" style="background:${col}"></div>
    <div class="pc-body">
      <div class="pc-stripe" style="background:${col}"></div>
      <div class="pc-badge" style="background:${col}">${phrase.num}</div>
      <div class="pc-label" style="color:${col}">${set.label}</div>
      <div class="pc-rule" style="background:${col}"></div>
      <div class="pc-key">${phrase.key}</div>
      <div class="pc-sent">${sent}</div>
    </div>`;
  inner.appendChild(card);
}

function revealPoster(){
  document.getElementById('app').classList.add('poster-open');
  setTimeout(()=>{
    const inner=document.getElementById('posterInner');
    if(inner)inner.scrollTo({top:0,behavior:'smooth'});
  },800);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN RUNNER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function runScene(idx){
  if(!isRunning)return;
  if(idx>=TOTAL){finishAll();return;}

  document.querySelectorAll('.scene').forEach(s=>s.classList.remove('active'));
  const sc=document.getElementById('sc'+idx);if(!sc)return;
  sc.classList.add('active');
  flashColor(SCENE_COLORS[idx]);
  if(idx>0)spawnParticles(SCENE_COLORS[idx]);
  updateTopBar(idx);
  animIn(idx);

  if(idx===6)buildClaim();
  if(idx===7)buildSupport();

  await speakText(NARRATION[idx]);
  if(!isRunning)return;

  if(idx===3){await runBanners('hook');     if(!isRunning)return;}
  if(idx===4){await runBanners('thesis');   if(!isRunning)return;}
  if(idx===9){await runBanners('conclusion');if(!isRunning)return;}

  await wait(600);if(!isRunning)return;
  current=idx+1;runScene(current);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTROLS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function handleMain(){
  if(!isRunning){
    isRunning=true;
    document.getElementById('btnMain').textContent='‚èπ  STOP';
    document.getElementById('btnMain').classList.add('stop');
    document.getElementById('btnSkip').disabled=false;
    runScene(current);
  } else stopAll();
}

function stopAll(){
  isRunning=false;bannerActive=false;
  synth.cancel();
  animTimers.forEach(t=>clearTimeout(t));animTimers=[];
  closeBanners();
  const btn=document.getElementById('btnMain');
  btn.textContent=current===0?'‚ñ∂  START':'‚ñ∂  RESUME';
  btn.classList.remove('stop');
  document.getElementById('btnSkip').disabled=true;
}

function skipNow(){
  bannerActive=false;synth.cancel();
  animTimers.forEach(t=>clearTimeout(t));animTimers=[];
  closeBanners();
  const next=current+1;
  if(next<TOTAL){current=next;isRunning?runScene(current):goToScene(current);}
}

function goToScene(idx){
  document.querySelectorAll('.scene').forEach(s=>s.classList.remove('active'));
  const sc=document.getElementById('sc'+idx);if(!sc)return;
  sc.classList.add('active');animIn(idx);updateTopBar(idx);
}

function finishAll(){
  isRunning=false;
  spawnParticles('var(--c-conclude)');spawnParticles('var(--c-intro)');
  revealPoster();
  const btn=document.getElementById('btnMain');
  btn.textContent='‚Ü∫  RESTART';btn.classList.remove('stop');
  document.getElementById('btnSkip').disabled=true;
  btn.onclick=()=>{
    current=0;
    Object.keys(posterSections).forEach(k=>delete posterSections[k]);
    document.getElementById('posterInner').innerHTML='';
    document.getElementById('app').classList.remove('poster-open');
    btn.textContent='‚ñ∂  START';btn.onclick=handleMain;
    goToScene(0);
  };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateTopBar(idx){
  document.getElementById('pfill').style.width=Math.round((idx/(TOTAL-1))*100)+'%';
  document.getElementById('sctr').textContent=String(idx+1).padStart(2,'0')+' / '+String(TOTAL).padStart(2,'0');
}
function flashColor(c){
  const f=document.getElementById('flash');f.style.background=c;f.classList.add('pop');
  setTimeout(()=>f.classList.remove('pop'),20);
}
function spawnParticles(color,cx,cy){
  const x=cx||window.innerWidth*0.4,y=cy||window.innerHeight*0.5;
  for(let i=0;i<9;i++){
    const p=document.createElement('div');p.className='pt';
    p.style.cssText=`left:${x-22+Math.random()*44}px;top:${y-15+Math.random()*30}px;background:${color};width:${3+Math.random()*5}px;height:${3+Math.random()*5}px;border-radius:${Math.random()>0.5?'50%':'2px'};animation-duration:${0.6+Math.random()*0.42}s;`;
    document.body.appendChild(p);setTimeout(()=>p.remove(),1200);
  }
}

document.addEventListener('keydown',e=>{
  if(e.key===' '){e.preventDefault();handleMain();}
  if(e.key==='ArrowRight')skipNow();
  if(e.key==='Escape')stopAll();
});
let _tx=0;
document.addEventListener('touchstart',e=>_tx=e.changedTouches[0].screenX,{passive:true});
document.addEventListener('touchend',e=>{if(e.changedTouches[0].screenX-_tx<-55)skipNow();});

loadVoice();
animIn(0);
updateTopBar(0);
</script>
</body>
</html>
